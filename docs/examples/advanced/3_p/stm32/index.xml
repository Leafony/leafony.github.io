<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Leafony – Basic Kit 2</title>
    <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/</link>
    <description>Recent content in Basic Kit 2 on Leafony</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="https://docs.leafony.com/docs/examples/advanced/3_p/stm32/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Docs: STM32で Web Bluetoothを使ったIoTアプリ入門</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_webbluetooth_iot/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_webbluetooth_iot/</guid>
      <description>
        
        
        &lt;p&gt;このサンプルはBasic Kitの&lt;a href=&#34;https://docs.leafony.com/docs/examples/advanced/1_p/basic/webbluetooth_iot/&#34;&gt;Web BLEを使ったIoTアプリ入門&lt;/a&gt;で紹介したものをSTM32で実現したものです。Web BLE アプリはBasic Kitと同じものを使用します。詳細はBasic Kitの&lt;a href=&#34;https://docs.leafony.com/docs/examples/advanced/1_p/basic/webbluetooth_iot/&#34;&gt;Web BLEを使ったIoTアプリ入門&lt;/a&gt;をご覧ください。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;webbluetooth.png&#34; alt=&#34;webbluetooth.png&#34;&gt;&lt;/p&gt;
&lt;br&gt;
&lt;p&gt;※本ウェブサイトに記載している会社名、商品名は、各社の商標または登録商標です。&lt;/p&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;STM32 MCU、BLE Sugar、4-Sensors、CR2032、USB&lt;/li&gt;
&lt;li&gt;Windows&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;、 Mac&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;、 Linux&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;のどれかのPC (開発用)&lt;/li&gt;
&lt;li&gt;Android&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;、 iPhone&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;、 iPad&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;のスマートフォンまたはタブレット&lt;/li&gt;
&lt;li&gt;Google Chrome (バージョン70.0.3526.0以降)&lt;/li&gt;
&lt;li&gt;Arduino IDE、STM32CubeProgrammer software V2.4.0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;サンプルアプリのソースコード&#34;&gt;サンプルアプリのソースコード&lt;/h2&gt;
&lt;p&gt;あらかじめどちらもダウンロードしてください。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_BLE&#34; target=&#34;_brank&#34;&gt;Arduino スケッチ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/WebBluetooth_for_Leafony_app&#34; target=&#34;_brank&#34;&gt;Web Bluetooth アプリ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;leafonyの構成&#34;&gt;Leafonyの構成&lt;/h2&gt;
&lt;p&gt;このサンプルでは下記のリーフ構成で試せます。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Q&amp;rsquo;ty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;AZ62&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;Connector Cover&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;AI01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;4-Sensors&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;AZ01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;USB&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;AP03&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;STM32 MCU&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac02&#34;&gt;AC02&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac02&#34;&gt;BLE Sugar&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/power/av01&#34;&gt;AV01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/power/av01&#34;&gt;CR2032&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;CR2032 coin cell battery&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;M2*18mm screw&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;リーフの組み立て&#34;&gt;リーフの組み立て&lt;/h2&gt;
&lt;p&gt;下図のようにリーフを組み立てましょう。&lt;/p&gt;
&lt;img src=&#34;./STM32_gs.png&#34; width=&#34;350&#34;&gt;
&lt;h2 id=&#34;ピンアサイン&#34;&gt;ピンアサイン&lt;/h2&gt;
&lt;p&gt;各リーフのピンアサインは下図を参考&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;stm32_web_bt_pinassign.jpg&#34;&gt;&lt;img src=&#34;stm32_web_bt_pinassign.jpg&#34; width=&#34;600&#34;&gt;&lt;/img&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;実行方法&#34;&gt;実行方法&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Arduino IDEで&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_BLE&#34; target=&#34;_brank&#34;&gt;STM32_4-Sensors_BLE.ino&lt;/a&gt;を書き込む&lt;/li&gt;
&lt;li&gt;ダウンロードした&lt;a href=&#34;https://github.com/Leafony/WebBluetooth_for_Leafony_app&#34; target=&#34;_brank&#34;&gt;Web Bluetooth アプリ&lt;/a&gt;の&lt;code&gt;index.html&lt;/code&gt;をGoogle Chromeで開く&lt;br&gt;
Webアプリの使い方の詳細は&lt;a href=&#34;https://docs.leafony.com/docs/getting-started/basic&#34;&gt;Basic Kit クイックスタートガイド&lt;/a&gt;を参考&lt;/li&gt;
&lt;/ol&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;A HREF=&#34;javascript:history.back()&#34;&gt;前のページに戻る&lt;/A&gt;
&lt;/p&gt;&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Windows 10 version 1703以降 &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;OS X Yosemite以降 &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Kernel 3.19+ and BlueZ 5.41+ installed. &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Android 6.0 Marshmallow以降 &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;iPhoneまたはiPadの場合は &lt;a href=&#34;https://itunes.apple.com/us/app/webble/id1193531073&#34; target=&#34;_brank&#34;&gt;WebBLE&lt;/a&gt;(有料)が必要です。iPhone、iPad版のChromeではWeb Bluetoothが実装されていないためです。 &lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: STM32 LoRa 受信機</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_rx/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_rx/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;AC07 LoRa Mary でデータを受信する最もシンプルなサンプルプロジェクトです。
&lt;a href=&#34;../stm32_lora_tx&#34;&gt;LoRa送信機&lt;/a&gt;や&lt;a href=&#34;../stm32_lora_tx_sensors/&#34;&gt;LoRa送信機 + 4-Sensors&lt;/a&gt;のデータを受信することができます。&lt;/p&gt;
&lt;h2 id=&#34;サンプルのソースコード&#34;&gt;サンプルのソースコード&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_LoRa_Receiver&#34;&gt;STM32_LoRa_Receiver&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;リーフ構成&#34;&gt;リーフ構成&lt;/h2&gt;
&lt;p&gt;下記の構成でリーフを組み立ててください。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AP03 STM32&lt;/li&gt;
&lt;li&gt;AZ01 USB&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;動作方法&#34;&gt;動作方法&lt;/h2&gt;
&lt;p&gt;PlatformIOを使用して、STM32にプログラムを書き込んでください。
PlatformIOの利用方法は&lt;a href=&#34;https://docs.leafony.com/docs/environment/stm32/platformio/&#34;&gt;PlatformIO IDE for VSCode の設定&lt;/a&gt;を参考にしてください。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;../stm32_lora_tx/&#34;&gt;LoRa送信機&lt;/a&gt;を用意してデータを受信してください。
下記のように、「Hello」、送信回数、受信強度 単位dBmが表示されます。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;Hello 10,-64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
    <item>
      <title>Docs: STM32 LoRa 署名付き通信</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_signed_communication/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_signed_communication/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;このチュートリアルではAC07 LoRa Maryリーフに搭載されるATECC608Aを使用して、LoRaの通信に署名をつける方法を紹介します。
通信に署名をつけることで、データの送り元が、受信者が意図したデバイスであるかどうかを判定することができ、通信の安全性が向上します。&lt;/p&gt;
&lt;h2 id=&#34;必要なもの&#34;&gt;必要なもの&lt;/h2&gt;
&lt;p&gt;このチュートリアルではLoRa送信機と受信機のペアが必要です。下記の構成で組み立てたリーフを2セット用意してください。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AP03 STM32&lt;/li&gt;
&lt;li&gt;AZ01 USB&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;atecc608aで署名付き通信を行う仕組み&#34;&gt;ATECC608Aで署名付き通信を行う仕組み&lt;/h2&gt;
&lt;p&gt;送信機と受信機に搭載されているAC07 LoRa Maryリーフには、Microchip社の暗号化チップATECC608Aが搭載されています。
このチップは楕円曲線DSA署名方式（ECDSA）を使用した署名をハードウェアの演算回路を使用して発行することができます。
ATECC608Aを使用した署名の発行と、データ通信の流れを図に表したものを下記に示します。
この図をもとに署名付き通信の流れを解説します。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./img/00.png&#34; width=&#34;800&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;1-キーペアを発行する&#34;&gt;1. キーペアを発行する&lt;/h3&gt;
&lt;p&gt;まず初めに、署名の発行を行うためにATECC608Aの初期化をする必要があります。
この初期化手順では、署名を行うためのキーペアをATECC608Aに発行してもらいます。
STM32リーフからI2CでATECC608Aにキーペア発行命令を送り、公開鍵と秘密鍵のキーペアを作成します。この時、公開鍵はI2C経由でSTM32リーフに伝えられ読み出すことができますが、秘密鍵はATECC608A内部のメモリーにのみ保存され、STM32側は読み出すことができない仕組みとなっています。&lt;/p&gt;
&lt;p&gt;読み出した公開鍵は、署名の検証に使うため、あらかじめ受信機側が知っている必要があります。受信機側にはソースコードに記述するなどの何らかの方法で公開鍵を渡しておく必要があります。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./img/01.png&#34; width=&#34;800&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;2-署名を発行してデータを送る&#34;&gt;2. 署名を発行してデータを送る&lt;/h3&gt;
&lt;p&gt;送信機側は「本日は晴天なり」というメッセージを送信したいとします。このメッセージを受信機に対して送る前にまず、ATECC608Aに送り、メッセージに対する署名を計算してもらいます。署名はメッセージと秘密鍵を用いて計算されます。この時、ATECC608Aの仕様により、メッセージは32バイトごとに分割し、それに対する署名はそれぞれ64バイトのサイズになります。&lt;/p&gt;
&lt;p&gt;署名を発行し終えたら、メッセージと署名を合わせてLoRa（UARTなど別の通信方法でも良い）で送信し受信機に伝えます。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./img/02.png&#34; width=&#34;800&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;3-受信機で署名を検証する&#34;&gt;3. 受信機で署名を検証する&lt;/h3&gt;
&lt;p&gt;署名付きメッセージを受信した受信機は、あらかじめ持っていた送信機の公開鍵と、受信したメッセージ、署名データをATECC608Aに渡します。ATECC608Aはこれらのデータから署名がこの公開鍵に対応する秘密鍵によって発行されたものかを検証します。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./img/03.png&#34; width=&#34;800&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;4-不正なデータが送られてきた&#34;&gt;4. 不正なデータが送られてきた&lt;/h3&gt;
&lt;p&gt;ここで、悪意を持った人が「本日は大荒れなり」というデータを送ってきたとします。これにはなんらかの署名がつけられていたとします。この不正なデータについた署名は、本来想定している送信機の秘密鍵を用いて作られた署名ではないため、受信機は公開鍵をもとに検証を行うと、キーペアの不一致によって検証結果は不正となります。&lt;/p&gt;
&lt;p&gt;この仕組みを使うことで、悪意のあるデータを見抜くことができます。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./img/04.png&#34; width=&#34;800&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;サンプルコード&#34;&gt;サンプルコード&lt;/h2&gt;
&lt;h3 id=&#34;atecc608aを初期化しキーペアの発行する&#34;&gt;ATECC608Aを初期化しキーペアの発行する&lt;/h3&gt;
&lt;p&gt;ATECC608Aは出荷時キーペアが保存されていないため、以降すべてのサンプルを実行する際に必要となるキーペアをあらかじめ発行しておきます。このサンプルは必ず実施してください。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;./00_config&#34;&gt;サンプルページへ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;データに署名をつける&#34;&gt;データに署名をつける&lt;/h3&gt;
&lt;p&gt;LoRaで通信を行う前に、まずは送信機単体でデータに署名をつけてみましょう。このサンプルはLoRa通信を行わず署名発行部分のみを抽出したシンプルなプロジェクトです。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;./01_sign&#34;&gt;サンプルページへ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;署名がついたデータを検証する&#34;&gt;署名がついたデータを検証する&lt;/h3&gt;
&lt;p&gt;LoRaで通信を行う前に、まずは送信機単体で署名の検証を行ってみましょう。自分自身が発行した署名を自分で検証できるかを確認してみます。署名検証を行うための最もシンプルなプロジェクトです。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;./02_verify&#34;&gt;サンプルページへ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;署名付きデータをloraで送信する&#34;&gt;署名付きデータをLoRaで送信する&lt;/h3&gt;
&lt;p&gt;実際にLoRaで送信するデータに署名をつけてみましょう。LoRaを使用した実用的なプロジェクトです。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;./03_signed_transfer&#34;&gt;サンプルページへ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;署名付きデータをloraで受信して検証する&#34;&gt;署名付きデータをLoRaで受信して検証する&lt;/h3&gt;
&lt;p&gt;実際にLoRaで受信した署名付きデータを検証してみましょう。LoRaを使用した実用的なプロジェクトです。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;./04_verify_receiving&#34;&gt;サンプルページへ&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: STM32 LoRa SORACOM</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_soracom/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_soracom/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;h2 id=&#34;サンプルのソースコード&#34;&gt;サンプルのソースコード&lt;/h2&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;h2 id=&#34;使用するリーフ&#34;&gt;使用するリーフ&lt;/h2&gt;
&lt;h2 id=&#34;動作方法&#34;&gt;動作方法&lt;/h2&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: STM32 LoRa メッセージ通信</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_tx/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_tx/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;このチュートリアルでは、メッセージを、LoRa Mary で通信をする方法を紹介します。&lt;/p&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;h3 id=&#34;送信側のリーフの構成&#34;&gt;送信側のリーフの構成&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AP03 STM32 MCU&lt;/li&gt;
&lt;li&gt;AV04 2V～4.5V&lt;/li&gt;
&lt;li&gt;AZ67 AAA battery holder&lt;/li&gt;
&lt;li&gt;AZ63 Nut Plate&lt;/li&gt;
&lt;li&gt;M2X12mmネジ 2本&lt;/li&gt;
&lt;li&gt;単4電池 3本&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;受信側のリーフの構成&#34;&gt;受信側のリーフの構成&lt;/h3&gt;
&lt;p&gt;LoRa Maryのアンテナ部分が、USBケーブルで覆われないようにするため、Back to backを使用します。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AP03 STM32&lt;/li&gt;
&lt;li&gt;AZ01 USB&lt;/li&gt;
&lt;li&gt;AX07 Back to back&lt;/li&gt;
&lt;li&gt;AZ63 Nut Plate 2P&lt;/li&gt;
&lt;li&gt;M2X8mmネジ 2本&lt;/li&gt;
&lt;li&gt;M2X10mmネジ 2本&lt;/li&gt;
&lt;li&gt;USBケーブル&lt;/li&gt;
&lt;li&gt;PC&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ソースコード&#34;&gt;ソースコード&lt;/h2&gt;
&lt;p&gt;ソースコードは、Arduino IDEとPlatformIO IDのふたつで用意しています。STM32 MCUの開発環境の設定は、&lt;a href=&#34;https://docs.leafony.com/docs/environment/#stm32-mcu-%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83&#34;&gt;こちら&lt;/a&gt;を参照して下さい。&lt;/br&gt;&lt;/p&gt;
&lt;h4 id=&#34;送信側&#34;&gt;送信側&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_LoRa_Transmitter&#34;&gt;Arduinoソースコード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_LoRa_Transmitter&#34;&gt;PlatformIOソースコード&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;受信側&#34;&gt;受信側&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_LoRa_Receiver&#34;&gt;Arduinoソースコード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_LoRa_Receiver&#34;&gt;PlatformIOソースコード&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;動作方法&#34;&gt;動作方法&lt;/h2&gt;
&lt;p&gt;以下のように、「Hello」、送信回数、受信強度 単位dBmが表示されます。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;Received: hello 0, RSSI: -37

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
    <item>
      <title>Docs: STM32 LoRa センサデータ通信</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_tx_sensors/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_lora_tx_sensors/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;h3 id=&#34;measuring-sensor-data&#34;&gt;Measuring Sensor Data&lt;/h3&gt;
&lt;p&gt;温度・湿度・照度・加速度のセンサーデータをLoRaを使ってパソコンへ送信するチュートリアルです。&lt;/p&gt;
&lt;h3 id=&#34;measuring-rssi&#34;&gt;Measuring RSSI&lt;/h3&gt;
&lt;p&gt;電波強度（RSSI）を測定するチュートリアルです。送信側も受信側も電池駆動なので屋外の設置現場のLoRaの電波強度の測定が容易に出来ます。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;AP07_Fig4.jpg&#34; alt=&#34;AP07_Fig4.jpg&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;p&gt;送信用と受信用の両方に対して、以下のリーフを組み立てることで、Measuring Sensor Data と Measuring RSSI の両方のチュートリアルを実施できます。&lt;/p&gt;
&lt;h3 id=&#34;送信側の構成&#34;&gt;送信側の構成&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AI01 4-Sensors&lt;/li&gt;
&lt;li&gt;AZ01 USB&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;AP03 STM32 MCU&lt;/li&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AV04 2V～4.5V&lt;/li&gt;
&lt;li&gt;AZ63 Nut Plate&lt;/li&gt;
&lt;li&gt;M2X16mmネジ 2本&lt;/li&gt;
&lt;li&gt;AZ67 AAA battery holder&lt;/li&gt;
&lt;li&gt;単4電池 3本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;./AP07_Fig2.jpg&#34;&gt;&lt;img src=&#34;./AP07_Fig2.jpg&#34; width=&#34;300&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h3 id=&#34;受信側のリーフの構成&#34;&gt;受信側のリーフの構成&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AI04 LCD&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;AP03 STM32&lt;/li&gt;
&lt;li&gt;AC07 LoRa Mary&lt;/li&gt;
&lt;li&gt;AX07 Back to bac&lt;/li&gt;
&lt;li&gt;AZ01 USB&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;AV04 2V～4.5V&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;AZ63 Nut Plate 2P&lt;/li&gt;
&lt;li&gt;M2X10mmネジ 2本&lt;/li&gt;
&lt;li&gt;M2X14mmネジ 2本&lt;/li&gt;
&lt;li&gt;USBケーブル&lt;/li&gt;
&lt;li&gt;PC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;./AP07_Fig3.jpg&#34;&gt;&lt;img src=&#34;./AP07_Fig3.jpg&#34; width=&#34;300&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h2 id=&#34;ソースコード&#34;&gt;ソースコード&lt;/h2&gt;
&lt;p&gt;ソースコードは、Arduino IDEとPlatformIO IDのふたつで用意しています。また、STM32 MCUの開発環境の設定は、&lt;a href=&#34;https://docs.leafony.com/docs/environment/#stm32-mcu-%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83&#34;&gt;こちら&lt;/a&gt;を参照して下さい。&lt;/br&gt;&lt;/p&gt;
&lt;h4 id=&#34;送信側&#34;&gt;送信側&lt;/h4&gt;
&lt;p&gt;Measuring Sensor Data と Measuring RSSI は、どちらも同じコードです。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_LoRa_4-Sensors_Transmitter&#34;&gt;Arduinoソースコード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_LoRa_4-Sensors_Transmitter&#34;&gt;PlatformIOソースコード&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;受信側&#34;&gt;受信側&lt;/h4&gt;
&lt;p&gt;Measuring Sensor Data と Measuring RSSI は、どちらも同じコードです。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_LoRa_Receiver_LCD&#34;&gt;Arduinoソースコード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_LoRa_Receiver_LCD&#34;&gt;PlatformIOソースコード&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;動作&#34;&gt;動作&lt;/h2&gt;
&lt;h3 id=&#34;measuring-sensor-data-1&#34;&gt;Measuring Sensor Data&lt;/h3&gt;
&lt;p&gt;受信側のリーフに繋いだパソコンに、電圧(V)、温度(℃)、湿度(%)、照度(lx)、加速度XYZ(g)、RSSI(dBm)が表示されます。&lt;/br&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;4.56V,25.19℃,61.27%,102.98lx,0.06g,0.27g,0.85g,-50
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;measuring-rssi-1&#34;&gt;Measuring RSSI&lt;/h3&gt;
&lt;p&gt;LCDに、RSSI(dBm)が表示されます。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;RSSI:
-60 dBm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p style=&#34;text-align: right&#34;&gt;
&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　ソースコードを書き込む時は必要で、書き込んだら外しても構いません。 &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　LCDに表示させる時は必要で、パソコンに表示させる時は不要です。 &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　ソースコードを書き込む時、パソコンに表示させる時、電源を供給する時は必要で、電池でLCDに表示させる時は不要です。 &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　電池で駆動させる時は必要で、USBから電源を供給する場合は不要です。 &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: STM32 Simple BLE Beacon</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_simple_ble_beacon/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_simple_ble_beacon/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;STM32リーフを使ったシンプルなBLE Beaconのサンプルデザインです。
「HELLO BEACON」という文字列を一定期間送信してからスリープを繰り返します。&lt;/p&gt;
&lt;h2 id=&#34;サンプルのソースコード&#34;&gt;サンプルのソースコード&lt;/h2&gt;
&lt;p&gt;使用するスケッチやツールのソースコードは下記のリポジトリで閲覧可能です。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_Simple_Beacon&#34; target=&#34;_blank&#34;&gt;Sample-Sketches/STM32_Simple_Beacon at master · Leafony/Sample-Sketches&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;h2 id=&#34;使用するリーフ&#34;&gt;使用するリーフ&lt;/h2&gt;
&lt;h2 id=&#34;動作方法&#34;&gt;動作方法&lt;/h2&gt;
&lt;h2 id=&#34;スケッチの解説&#34;&gt;スケッチの解説&lt;/h2&gt;
&lt;h3 id=&#34;フローチャート&#34;&gt;フローチャート&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;STM32_Simple_Beacon.ino&lt;/code&gt;の&lt;code&gt;loop()&lt;/code&gt;関数の動作は下図のように、STM32リーフとBLEリーフが交互にスリープ状態とアクティブ状態を一定の時間繰り返しながらBeaconのパケット(Advertising data)を送信することで、省電力なシステムを実現しています。&lt;/p&gt;
&lt;p&gt;STM32リーフが&lt;code&gt;StartAdvData()&lt;/code&gt;を実行すると、BLEリーフでブロードキャストしたいAdvertising dataを設定し、送信を開始するコマンドを送ります。&lt;/p&gt;
&lt;p&gt;BLEリーフがAdvertising中、STM32リーフは何もしないため、&lt;code&gt;LowPower.deepSleep()&lt;/code&gt;関数でディープスリープモードに移行し、&lt;code&gt;WAKE_INTERVAL&lt;/code&gt;で設定した時間が経過後、再びアクティブ状態に戻ります。この間、STM32リーフでは必要最小限の電力で動作できるように不要な回路ブロックの電源を落とす等をし、非常に省電力な状態で動作します。&lt;/p&gt;
&lt;p&gt;STM32リーフがアクティブ状態に移行後、&lt;code&gt;sleepBLE()&lt;/code&gt;関数を実行し、BLEリーフのAdvertisingを停止させ、BLEリーフをスリープモードに移行させます。その後すぐにSTM32リーフ自身も&lt;code&gt;LowPower.deepSleep()&lt;/code&gt;関数で&lt;code&gt;SLEEP_INTERVAL&lt;/code&gt;で設定した時間ディープスリープモードに移行します。この状態においては極わずかな電力しか消費せず、&lt;code&gt;SLEEP_INTERVAL&lt;/code&gt;の時間を長くすればするほど電池の持ちを良くすることができます。&lt;/p&gt;
&lt;p&gt;STM32リーフがディープスリープから復帰後、すぐにBLEリーフを起動させ、再び&lt;code&gt;StartAdvData()&lt;/code&gt;を実行して最初の処理に戻ります。&lt;/p&gt;
&lt;img src=&#34;loop_timing_chart.svg&#34;&gt;
&lt;h3 id=&#34;advertising-dataの仕様&#34;&gt;Advertising dataの仕様&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;STM32_Simple_Beacon.ino&lt;/code&gt;の&lt;code&gt;StartAdvData()&lt;/code&gt;関数では、BLEリーフにAdvertising dataを設定し、BLE Client（PCやスマホ、Raspberry Pi等のLeafonyとBLE接続する機器）でLeafonyを検出した際に表示されるデバイス名を「Leaf_A」とし、ユーザデータとして「HELLO BEACON」という文字列を送信しています。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;adv_data[]&lt;/code&gt;配列がAdvertising dataです。この配列はコメントに記載されているように、&lt;code&gt;AD Structure 1&lt;/code&gt;～&lt;code&gt;AD Structure 3&lt;/code&gt;というデータの塊を繋げたデータとなっています。これらのデータの内容については後述します。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ble112.ble_cmd_le_gap_set_adv_data()&lt;/code&gt;で&lt;code&gt;adv_data&lt;/code&gt;をBLEリーフに登録し、BLEリーフ側から登録完了の信号が来るのを待つために、&lt;code&gt;ble112.checkActivity()&lt;/code&gt;を実行しています。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ble112.ble_cmd_le_gap_start_advertising()&lt;/code&gt;を実行することで、BLEがAdvertisingを開始して、先程設定したAdvertising dataをブロードキャストし始めます。&lt;code&gt;LE_GA_SCANNABLE_NON_CONNECTALBE&lt;/code&gt;を設定したことで、BLE Client側はAdvertising dataをスキャンすることはできますが、このデバイスと接続を確立することは禁止しています。これは、接続要求が来た場合に発生するイベントの処理を減らして電力を削減するための設定です。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;StartAdvData&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Advertising data; 25byte MAX
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 1: Flag
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//0: field length
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;BGLIB_GAP_AD_TYPE_FLAGS&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//1: field type (0x01)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//2: data
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 2: Complete local name
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//3: field length
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;BGLIB_GAP_AD_TYPE_LOCALNAME_COMPLETE&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//4: field type (0x09)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//5:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;e&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//6:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//7:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;f&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//8:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;_&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//9:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//10:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 3: Manufacture specific
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;   &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//11: field length
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xff&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//12: field type (0xff)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;H&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//13:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;E&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//14:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//15:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//16:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;O&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//17:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//18:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;B&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//19:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;E&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//20:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//21:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;C&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//22:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;O&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//23:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;N&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//24:
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;};&lt;/span&gt;

  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Register advertising packet
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;stLen&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble_cmd_le_gap_set_adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;SCAN_RSP_ADVERTISING_PACKETS&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;stLen&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;checkActivity&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;));&lt;/span&gt;

  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// index = 0  LE_GAP_SCANNABLE_NON_CONNECTABLE / LE_GAP_UNDIRECTED_CONNECTABLE
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble_cmd_le_gap_start_advertising&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;LE_GAP_USER_DATA&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;LE_GAP_SCANNABLE_NON_CONNECTABLE&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;checkActivity&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;));&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下図はBLEのAdvertisingで使用される、Advertising dataのフォーマットを表しています。&lt;/p&gt;
&lt;p&gt;Advertising dataは複数の&lt;code&gt;AD Structure&lt;/code&gt;というデータの塊から構成されています。各&lt;code&gt;AD Structure&lt;/code&gt;の中身は&lt;code&gt;Length&lt;/code&gt;と&lt;code&gt;Data&lt;/code&gt;に分けられ、&lt;code&gt;Length&lt;/code&gt;には、&lt;code&gt;Data&lt;/code&gt;のオクテット数(何byteか)が登録されます。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Data&lt;/code&gt;の中身は更に、&lt;code&gt;AD Type&lt;/code&gt;と&lt;code&gt;AD Data&lt;/code&gt;に分けられ、&lt;code&gt;AD Type&lt;/code&gt;でこの&lt;code&gt;AD Structure&lt;/code&gt;がどのような意味のデータなのかが分かるようになっています。&lt;/p&gt;
&lt;p&gt;例えば、上記コードの&lt;code&gt;AD Structure 2&lt;/code&gt;は&lt;code&gt;Length&lt;/code&gt;が7で、&lt;code&gt;AD Type&lt;/code&gt;は&lt;code&gt;BGLIB_GAP_AD_TYPE_LOCALNAME_COMPLETE (0x09)&lt;/code&gt;でデバイスのローカルネームであることがわかり、&lt;code&gt;Data&lt;/code&gt;に&lt;code&gt;Leaf_A&lt;/code&gt;と登録されています。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;AD Structure 3&lt;/code&gt;の&lt;code&gt;AD Type&lt;/code&gt;は0xffで、この&lt;code&gt;AD Structure&lt;/code&gt;には任意のデータを登録することができます。&lt;code&gt;Data&lt;/code&gt;には「HELLO BEACON」というテキストが登録されていて、このデータを変えれば自由にデータをAdvertising dataに載せてブロードキャストすることができます。&lt;/p&gt;
&lt;img src=&#34;advertising_data_format.svg&#34;&gt;
&lt;h3 id=&#34;bleリーフの動作&#34;&gt;BLEリーフの動作&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;各種設定&lt;/li&gt;
&lt;li&gt;イベントハンドラ&lt;/li&gt;
&lt;/ul&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;A HREF=&#34;javascript:history.back()&#34;&gt;前のページに戻る&lt;/A&gt;
&lt;/p&gt;
      </description>
    </item>
    
    <item>
      <title>Docs: STM32 Logger Beacon</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_logger_ble_beacon/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_logger_ble_beacon/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;STM32リーフに搭載されたFlashメモリを使って、温湿度と測定時間を記録することが可能なBLE Beaconのサンプルデザインです。&lt;br&gt;
STM32リーフとBLEリーフを使った、センサデータのログ機能付きの実用的なIoTシステムのサンプルデザインです。&lt;br&gt;
このサンプルには下記の機能が実装されています。&lt;br&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;温度、湿度、照度の観測&lt;/li&gt;
&lt;li&gt;測定データをBLEのBeacon機能で送信&lt;/li&gt;
&lt;li&gt;オンチップFlashに測定データを保存&lt;/li&gt;
&lt;li&gt;リアルタイムクロックを使った測定時刻の保存&lt;/li&gt;
&lt;li&gt;ブラウザアプリでデバイスの設定変更&lt;/li&gt;
&lt;li&gt;ブラウザアプリで測定データの吸い出しとグラフ化&lt;/li&gt;
&lt;li&gt;加速度センサを使った振動検知機能によるBLE送信モードの変更&lt;/li&gt;
&lt;li&gt;低電力動作モードで半年以上の連続駆動&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;サンプルのソースコード&#34;&gt;サンプルのソースコード&lt;/h2&gt;
&lt;p&gt;使用するスケッチやツールのソースコードは下記のリポジトリで閲覧可能です。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_Logger_Beacon&#34; target=&#34;_blank&#34;&gt;Sample-Sketches/STM32_Logger_Beacon at master · Leafony/Sample-Sketches&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.leafony.com/Sample-Sketches/STM32_Logger_Beacon/sample_web_app/lescan/&#34; target=&#34;_blank&#34;&gt;STM32 Sensors Logger Webアプリケーション&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;対応環境&#34;&gt;対応環境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 Version 1703以降
&lt;ul&gt;
&lt;li&gt;Beacon機能は利用不可&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Mac OS X Yosemite以降&lt;/li&gt;
&lt;li&gt;Android 6.0 Marshmallow以降&lt;/li&gt;
&lt;li&gt;Linux Kernel 3.19+ 以降
対応状況詳細は&lt;a href=&#34;https://github.com/WebBluetoothCG/web-bluetooth/blob/master/implementation-status.md#scanning-api&#34; target=&#34;_brank&#34;&gt;Webbluetooth Implementation Status&lt;/a&gt;を御覧ください。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Leafony&lt;/li&gt;
&lt;li&gt;Google Chrome&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;使用するリーフ&#34;&gt;使用するリーフ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Q&amp;rsquo;ty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;AI01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;4-Sensors&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;AP03&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;STM32 MCU&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;AZ01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;USB&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac02&#34;&gt;AC02&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac02&#34;&gt;BLE Sugar&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/power/av01&#34;&gt;AV01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/power/av01&#34;&gt;CR2032&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;CR2032 coin cell battery&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;M2*18mm screw&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;動作方法&#34;&gt;動作方法&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;STM32リーフにサンプルスケッチ&lt;code&gt;STM32_Logger_Beacon.ino&lt;/code&gt;を書き込んでください。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Google Chromeで&lt;a href=&#34;https://docs.leafony.com/Sample-Sketches/STM32_Logger_Beacon/sample_web_app/lescan/&#34; target=&#34;_blank&#34;&gt;STM32 Sensors Logger Webアプリケーション&lt;/a&gt;を開いてださい。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Start Scanning&lt;/code&gt;ボタンを押すと、Bluetooth利用許可を求めるポップアップウィンドウ表示されます。&lt;code&gt;許可&lt;/code&gt;を押すとBeaconの電波の受信を開始します。&lt;br&gt;
Leafonyから発されるBeaconの電波を受信すると、画面の温度/電池電圧/受信時刻表示が更新されます。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Connect&lt;/code&gt;ボタンを押すとLeafonyに接続され、数秒ほど待つとFlashメモリに保存されていた過去の測定データを受信し、画面上のグラフが更新されます。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;受信完了後は&lt;code&gt;Disconnect&lt;/code&gt;ボタンを押しLeafonyと切断すると、Leafonyは再度Beaconモードに移行し、センサ情報の記録を再開します。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;動作解説&#34;&gt;動作解説&lt;/h2&gt;
&lt;h3 id=&#34;回路全体のブロック図&#34;&gt;回路全体のブロック図&lt;/h3&gt;
&lt;p&gt;本サンプルコードで利用する回路は下図のとおりです。&lt;/p&gt;
&lt;p&gt;主にBLE、センサ、STM32リーフで構成され、特にSTM32リーフでは内部のRTC(リアルタイムクロック)とFlashを利用しています。&lt;/p&gt;
&lt;p&gt;RTCは、BLEを経由してPCやスマートフォンから時刻を設定して使います。&lt;/p&gt;
&lt;p&gt;Flashはプログラムメモリの保存以外に、末尾2kBをユーザがデータを保存できる領域として使うことができます。本サンプルでは、この領域にセンサデータと測定時刻を保存し、本体の電源が切れた後もデータを保持できる仕組みとなっています。&lt;/p&gt;
&lt;p&gt;センサリーフからは温度、湿度、照度センサがSTM32によって読み出され、BLEでデータが送信されます。加速度センサは振動によって割り込み信号を発生し、STM32をスリープから復帰させる役割があります。&lt;/p&gt;
&lt;img src=&#34;block.jpg&#34;&gt;
&lt;h3 id=&#34;動作の流れ&#34;&gt;動作の流れ&lt;/h3&gt;
&lt;p&gt;このサンプルコードでは主に以下の2つの動作モードが存在します。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Beaconモード&lt;/li&gt;
&lt;li&gt;Connectionモード&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Leafonyに電源を入れると、まず初めに本体の初期化を行なった後に&lt;strong&gt;Beaconモード&lt;/strong&gt;に入ります。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Beaconモード&lt;/strong&gt;では、通常は本体が長時間のスリープ状態に入り、一定時間が経過すると本体がスリープから復帰します。（このスリープ時間はユーザが任意に設定できます。)&lt;br&gt;
本体がスリープから復帰すると、まずSTM32が起動し、センサを起動させ、温度、湿度、照度を測定します。&lt;br&gt;
このとき、STM32に搭載されたリアルタイムクロックに時刻が設定されている場合、測定されたデータはSTM32に搭載されたFlashに保存されます。&lt;br&gt;
その後、BLEリーフを起動し、Advertisingパケットにセンサデータを設定し、BLEリーフが一定期間Advertisingを開始します。&lt;br&gt;
このAdvertisingパケットをウェブアプリで受信することで、温度、湿度、照度のデータをPCやスマートフォンで見ることができます。&lt;br&gt;
一定期間のAdvertising後は即座に本体がスリープし、消費電力を最小に抑えます。&lt;br&gt;
Beaconモードでの動作時間が長いほど、電池消費を抑えることが可能です。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Connectionモード&lt;/strong&gt;では、主にPCやスマートフォンでと双方向で通信して、スリープ時間やAdvertising時間を設定したり、Flashに保存されたデータの吸い出しを行い、ウェブアプリでグラフ化するための通信を行います。&lt;br&gt;
このモードでは通信中、またはPCやスマートフォンと接続を確立するためのAdvertising期間、常に本体がアクティブ状態にあり、電池消費が大きくなります。&lt;br&gt;
Connectionモードは、本体の時刻を設定するなどの初回起動時や、ある程度ログデータが溜まった後にデータを吸い出すといったような、利用シーンが限られてくるため、特定の条件でのみこのモードに入るよう設定されています。&lt;br&gt;
このサンプルではConnectionモードに入るためには、&lt;strong&gt;Leafony本体を左右に強く振る&lt;/strong&gt;ことでConnectionモードに入ることができます。&lt;br&gt;
これは、4-Sensorsリーフに搭載された加速度センサが、常に振動を観測し、振動を検知すると即座にSTM32リーフに割り込み信号を送信することで実現されています。&lt;/p&gt;
&lt;img style=&#34;width: 100%;&#34; src=&#34;timediagram.jpg&#34;&gt;
&lt;h3 id=&#34;動作モードの切り替え&#34;&gt;動作モードの切り替え&lt;/h3&gt;
&lt;p&gt;BeaconモードとConnectionモードの切り替えには加速度センサによる割り込みを使います。&lt;br&gt;
ウェブアプリでBluetoothデバイスを検出するためには、LeafonyがConnectionモードに切り替わり、最低でも数秒から数十秒程度の長い間BLEがAdvertisingする必要があります。&lt;br&gt;
これを毎スリープからの復帰後に行なっていると電池消費が非常に大きくなってしまうため、BLEで接続したい時だけConnectionモードに入り長時間Advertisingさせたくなります。&lt;br&gt;
今回はこれを加速度センサを使った振動検出割り込みで実現しました。&lt;/p&gt;
&lt;p&gt;4-Sensorsに搭載された加速度センサは、振動(指で本体をタップする動作)を検出すると、STM32の&lt;code&gt;INT1ピン&lt;/code&gt;に割り込み信号を出します。&lt;br&gt;
下記の記述で加速度センサのタップ検出を有効化し、その割り込みによってSTM32がスリープから復帰する仕組みを実現しています。&lt;br&gt;
か速度センサの割り込みによって起動した場合のみConnectモードとして起動させることで、必要な時だけBLEで接続可能な仕組みを実現しました。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;color:#000&#34;&gt;accel&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;setClick&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;DOUBLETAP&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;CLICKTHRESHHOLD&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// enable click interrupt
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// enable interrupt from accelerometer click event
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;LowPower&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;attachInterruptWakeup&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;INT_1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;onClicked&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;RISING&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;DEEP_SLEEP_MODE&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;不揮発メモリのアドレスマップ&#34;&gt;不揮発メモリのアドレスマップ&lt;/h3&gt;
&lt;p&gt;STM32リーフには内部に不揮発性メモリ（Flashメモリ）が搭載されています。&lt;br&gt;
本サンプルでは、このFlashメモリを、ユーザ設定の保存と、測定データ保存用のリングバッファとして扱います。&lt;br&gt;
下図のように、メモリの先頭からいくつかの番地には、スリープ時間や起動時間などのユーザ設定を保存する領域があります。&lt;br&gt;
それらを除いた部分を、時刻とセンサのデータを保持するリングバッファとして扱います。&lt;br&gt;
また、Flashに書き込まれているデータが、本サンプルスケッチによって書き込まれたものなのかを確かめるため、先頭2バイトに&lt;code&gt;0xAA&lt;/code&gt;という値を保存しています。&lt;br&gt;
本サンプルではこの&lt;code&gt;0xAA&lt;/code&gt;が書き込まれていればいれば、保存されている設定を読み込み、書き込まれていなければ新規に初期値をFlashに保存するという動作をします。&lt;/p&gt;
&lt;img src=&#34;ringbuffer.jpg&#34;&gt;
&lt;h3 id=&#34;beacon送信データ&#34;&gt;Beacon送信データ&lt;/h3&gt;
&lt;p&gt;Beaconモードで動作している場合、BLEはセンサのデータを含むAdvertisingパケットを送信しています。&lt;br&gt;
Advertisingパケットの構造は次の図のように、&lt;code&gt;AD Structure&lt;/code&gt;というデータの塊が連なった形式となっています。&lt;br&gt;
AD Structureはさらに細かく見ると、&lt;code&gt;Length&lt;/code&gt;:データの長さ、&lt;code&gt;AD Type&lt;/code&gt;:データの種類・意味、&lt;code&gt;AD Data&lt;/code&gt;:送信したいデータで構成されています。&lt;/p&gt;
&lt;img src=&#34;adstructure.jpg&#34;&gt;
&lt;p&gt;実際に本サンプルでは下記のコードのように、&lt;code&gt;AD Structure 1&lt;/code&gt;にAdvertisingのモード設定、&lt;code&gt;AD Structure 2&lt;/code&gt;にデバイス名、&lt;code&gt;AD Structure 3&lt;/code&gt;にセンサのデータを保存して送信しています。&lt;br&gt;
Beaconで送信するデータを変更したい場合は&lt;code&gt;AD Structure 3&lt;/code&gt;を任意に変更してください。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L272-L302&#34;&gt;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L272-L302&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//-------------------------
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Advertising Packet
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;//-------------------------
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 1 (Flags)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0x02&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;                    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// field length
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;BGLIB_GAP_AD_TYPE_FLAGS&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Type (Flags)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;     &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// LE General Discover Mode | BR/EDR Not Supported
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;
  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 2 (Complete Local Name)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;strDeviceName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;length&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;           &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// field length
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;BGLIB_GAP_AD_TYPE_LOCALNAME_COMPLETE&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Type (Complete Local Name)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;strDeviceName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;length&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;strDeviceName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;charAt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Local Name
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;

  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Structure 3 (Manufacturer Specific Data)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// field lengh
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xff&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// AD Type (Manufacturer Specific Data)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;illum&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Illuminance (Upper)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;illum&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;           &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Illuminance (Lower)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;temp&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;     &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Temperature (Upper)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;temp&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;            &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Temperature (Lower)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;humid&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Humidity (Upper)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;humid&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;           &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Humidity (Lower)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;battVolt&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Battery Voltage (Upper)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;battVolt&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;        &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Battery Boltage (Lower)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;
  &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// register advertising packet
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;stLen&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;index&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble_cmd_le_gap_set_adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;SCAN_RSP_ADVERTISING_PACKETS&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;stLen&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;adv_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ble112&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;checkActivity&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;センサの変更方法&#34;&gt;センサの変更方法&lt;/h3&gt;
&lt;p&gt;本サンプルでは4-Sensorsリーフに搭載された、温度・湿度・照度センサ、バッテリーリーフに搭載されたADCを読み出す仕組みとなっています。&lt;br&gt;
これらのセンサは、&lt;code&gt;setup()&lt;/code&gt;関数内の&lt;code&gt;setupSensors()&lt;/code&gt;関数で初期化し、&lt;code&gt;loop()&lt;/code&gt;関数内の&lt;code&gt;wakeupSensors()&lt;/code&gt;でスリープから復帰、&lt;code&gt;getSensors()&lt;/code&gt;でデータを取得、&lt;code&gt;sleepSensors()&lt;/code&gt;でスリープを行なっています。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L767-L771&#34;&gt;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L767-L771&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;任意のセンサを追加したい場合はこれらの関数内に必要な処理を記述してください。&lt;/p&gt;
&lt;h3 id=&#34;bleコマンドの変更方法&#34;&gt;BLEコマンドの変更方法&lt;/h3&gt;
&lt;p&gt;BLEで接続したPCやスマートフォンからコマンドを送信してLeafony側の設定を変更したり、データの転送を開始したりすることができます。&lt;br&gt;
下記のソースコードの部分でそのコマンドと処理を記述しています。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L934-L1107&#34;&gt;https://github.com/Leafony/Sample-Sketches/blob/4e474bcb1f154025873ecf883ddc998df58605cf/STM32_Logger_Beacon/STM32_Logger_Beacon.ino#L934-L1107&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;==
任意のコマンドを追加する場合は上記部分を修正してください。&lt;/p&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;A HREF=&#34;javascript:history.back()&#34;&gt;前のページに戻る&lt;/A&gt;
&lt;/p&gt;
      </description>
    </item>
    
    <item>
      <title>Docs: Google Sheetsを使ったIoTサービス</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_google_sheets_iot/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_google_sheets_iot/</guid>
      <description>
        
        
        &lt;h2 id=&#34;概要&#34;&gt;概要&lt;/h2&gt;
&lt;p&gt;Leafony blockは、センシングデータをBeacon&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;の電波で飛ばします。beaconの電波をRaspberry Piが受け、インターネット経由でGoogle スプレッドシートに書かせて、データの可視化が出来ます。&lt;/p&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Basic Kit 2&lt;/li&gt;
&lt;li&gt;Raspberry Pi 3B等&lt;/li&gt;
&lt;li&gt;ブラウザが閲覧できるパソコンやスマホ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;システム構成&#34;&gt;システム構成&lt;/h2&gt;
&lt;p&gt;Leafony block、Raspbery Pi、インターネット、そして、Google スプレットシートだけで、センシングしたデータを可視化出来ます。システム構成図を以下に記します。また、Leafony blockは、Basic Kit 2 スタートガイドで使用したものとスケッチ含め一緒です。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./gs_about.jpg&#34; alt=&#34;gs_about&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;raspberry-piの環境構築&#34;&gt;Raspberry Piの環境構築&lt;/h2&gt;
&lt;p&gt;初めてRaspberry Piをご使用になる方は、&lt;a href=&#34;https://www.switch-science.com/catalog/3880/&#34; target=&#34;blank&#34;&gt;Raspberry Pi 3 B＋ スターターキット&lt;/a&gt; が便利です。Raspbian OSイメージを書き込んだmicroSDが入っています。Raspberry Pi は、無線LANでインターネットに接続して使用します。&lt;/br&gt;&lt;/p&gt;
&lt;p&gt;今回使用するサンプルコードでは、Node.jsでnobleを使ってBLE Beaconを受信します。受信したデータはGoogle API経由でGoogle スプレッドシートに書き込みます。&lt;/p&gt;
&lt;p&gt;下記のスクリプト(6項目)を実行して環境構築をします。&lt;a href=&#34;https://github.com/Leafony/leafony-beacon/tree/master/spreadsheet-logger&#34; target=&#34;blank&#34;&gt;&lt;a href=&#34;https://github.com/Leafony/leafony-beacon/tree/master/spreadsheet-logger&#34;&gt;https://github.com/Leafony/leafony-beacon/tree/master/spreadsheet-logger&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;sudo apt update
sudo apt upgrade
sudo apt install -y bluetooth libbluetooth-dev libudev-dev git
git clone https://github.com/Leafony/leafony-beacon
&lt;span style=&#34;color:#204a87&#34;&gt;cd&lt;/span&gt; leafony-beacon/spreadsheet-logger
npm install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;注意:WARNINGと表示されますが、このまま進んでください。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./gs_pi_1.png&#34; alt=&#34;gs_pi_1&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;google-スプレットシートのapiの取得&#34;&gt;Google スプレットシートのAPIの取得&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Google スプレットシートをNode.jsで操作するためには、APIを取得する必要があります。下記 Node.js Quick Start のStep.1で、  Enable the Google Sheets API をクリックし、credentials.jsonをダウンロードします。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Node.js Quickstart | Sheets API | Google Developers : &lt;a href=&#34;https://developers.google.com/sheets/api/quickstart/nodejs&#34; target=&#34; blank&#34;&gt;&lt;a href=&#34;https://developers.google.com/sheets/api/quickstart/nodejs&#34;&gt;https://developers.google.com/sheets/api/quickstart/nodejs&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Raspberry Piのleafony-beacon/spreadsheet-loggerディレクトリに、credentials.jsonをコピーしてください。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;google-スプレッドシートのidと名前の設定&#34;&gt;Google スプレッドシートのIDと名前の設定&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Google スプレッドシート を開いて、URLの赤線部分の&lt;code&gt;spredsheetID&lt;/code&gt;と&lt;code&gt;sheetName&lt;/code&gt;を確認します。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;./gs_pi_2.png&#34; alt=&#34;gs_pi_2&#34;&gt;
&lt;img src=&#34;./gs_pi_3.png&#34; alt=&#34;gs_pi_3&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Raspberry Piのleafony-beacon/spreadsheet-loggerディレクトリの「index.js」のファイルに、スプレッドシートのIDと名前を書き込みます。
「index.js」の18, 19行目に上記の&lt;code&gt;spredsheetID&lt;/code&gt;と&lt;code&gt;sheetName&lt;/code&gt;を貼り付けて下さい。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;./gs_pi_4.png&#34; alt=&#34;gs_pi_4&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;raspberry-pi-でbeaconの受信の仕方&#34;&gt;Raspberry Pi でBeaconの受信の仕方&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Raspberry piのターミナルに「sudo node .」と入力してEnterをクリックしてください。
&lt;img src=&#34;./gs_pi_5.png&#34; alt=&#34;gs_pi_5&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;上記URLにブラウザでアクセスすると、Googleアカウントに移動し、ご自身のアカウントを選択します。
&lt;img src=&#34;./gs_pi_6.png&#34; alt=&#34;gs_pi_6&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;「詳細」をクリックしてください。
&lt;img src=&#34;./gs_pi_7.png&#34; alt=&#34;gs_pi_7&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;「Leafony Beacon Logger「安全ではないページ」に移動」をクリックしてください。
&lt;img src=&#34;./gs_pi_8.png&#34; alt=&#34;gs_pi_8&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;「詳細」をクリックしてください。
&lt;img src=&#34;./gs_pi_9.png&#34; alt=&#34;gs_pi_9&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;「Leafony Beacon Logger「安全ではないページ」に移動」をクリックしてください。
&lt;img src=&#34;./gs_pi_10.png&#34; alt=&#34;gs_pi_10&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;「許可」をクリックしてください。以下のコードをコピーしてください。ターミナル内に貼り付けると、「token.json」というファイルが生成されたあとに、beaconのスキャンが始まります。
&lt;img src=&#34;./gs_pi_11.png&#34; alt=&#34;gs_pi_11&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Beaconが見つかるとログが表示されると同時に、スプレッドシートに同じ内容が追記されるので、スプレッドシートを開いてデータを確認してください。
&lt;img src=&#34;./gs_pi_12.png&#34; alt=&#34;gs_pi_12&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;A HREF=&#34;javascript:history.back()&#34;&gt;前のページに戻る&lt;/A&gt;
&lt;/p&gt;&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　Beaconとは、地上にある電波を特定の機器で受信することで、位置をはじめとした各種情報を取得するための設備です。BluetoothのBeacon機器の場合、温度や気圧などのセンサを搭載したモジュールを任意の場所に設置して、その場所の環境を観測します。 &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: STM32で人物検出する推論ネットワークの実装</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_person_detection/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/stm32_person_detection/</guid>
      <description>
        
        
        &lt;h2 id=&#34;概要&#34;&gt;概要&lt;/h2&gt;
&lt;p&gt;カメラで画像データを取得し，学習済みネットワークを利用して人物検出を行います。&lt;br&gt;
ここではSTM32リーフ上にネットワークを実装する方法を説明します。&lt;br&gt;
実装の際にはカメラやディスプレイが必要ですが，最小限の説明に留めていますので予めご了承ください。&lt;/p&gt;
&lt;h2 id=&#34;使用するリーフ&#34;&gt;使用するリーフ&lt;/h2&gt;
&lt;p&gt;以下のリーフを使用します。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Type&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Name&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Q&amp;rsquo;ty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;AZ62&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;Connector Cover&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;AZ01&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az01&#34;&gt;USB&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap04&#34;&gt;AP04&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap04&#34;&gt;STM32 MCU 2Bus&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai02&#34;&gt;AI02&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai02&#34;&gt;SP&amp;amp;PIR&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/extension/ax08&#34;&gt;AX08&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/extension/ax08&#34;&gt;29pin header&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az63&#34;&gt;AZ63&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az63&#34;&gt;Nut Plate&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;M2*10mm screw&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;事前準備&#34;&gt;事前準備&lt;/h2&gt;
&lt;h3 id=&#34;カメラの準備&#34;&gt;カメラの準備&lt;/h3&gt;
&lt;p&gt;Leafonyにはカメラ専用コネクタがありません。&lt;br&gt;
今回はSPI通信でデータ通信が可能な&lt;a href=&#34;https://www.switch-science.com/catalog/3780/&#34;&gt;ArduCAM Mini (2メガピクセル)&lt;/a&gt;を用意しました。&lt;/p&gt;
&lt;h3 id=&#34;ディスプレイの準備&#34;&gt;ディスプレイの準備&lt;/h3&gt;
&lt;p&gt;カメラから正しくデータを受け取れているかを確認するためにディスプレイを用意します。&lt;br&gt;
今回はSPI通信でデータを表示することが可能な&lt;a href=&#34;https://reference.digilentinc.com/reference/pmod/pmodmtds/start&#34;&gt;Pmod MTDS&lt;/a&gt;を利用しました。&lt;/p&gt;
&lt;h3 id=&#34;深層学習ネットワークの準備&#34;&gt;深層学習ネットワークの準備&lt;/h3&gt;
&lt;p&gt;今回の人物検出はSTマイクロ社が用意されている学習済みネットワークを利用します。&lt;br&gt;
まずは，&lt;a href=&#34;https://www.st.com/ja/embedded-software/fp-ai-vision1.html&#34;&gt;FP-AI-VISION1&lt;/a&gt;をダウンロードします。&lt;/p&gt;
&lt;h2 id=&#34;各種ドライバの準備&#34;&gt;各種ドライバの準備&lt;/h2&gt;
&lt;h3 id=&#34;カメラのドライバ&#34;&gt;カメラのドライバ&lt;/h3&gt;
&lt;p&gt;githubにArduCAMがArduino環境用に用意された&lt;a href=&#34;https://github.com/ArduCAM/STM32/tree/master/User&#34;&gt;ライブラリ&lt;/a&gt;がアップロードされています。&lt;br&gt;
今回はHALライブラリを利用するのでSPIを通信する部分を少し書き換える必要があります&lt;br&gt;
STM32用のライブラリもアップロードされていますが，Standard Peripheral Libraryを利用しており，今回は使えません。&lt;/p&gt;
&lt;h3 id=&#34;ディスプレイのドライバ&#34;&gt;ディスプレイのドライバ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Digilent/vivado-library/tree/master/ip/Pmods/PmodMTDS_v1_0/drivers/PmodMTDS_v1_0&#34;&gt;digilent社の公式のgithub&lt;/a&gt;にディスプレイをコントロールする関数が公開されています。&lt;br&gt;
こちらもHALライブラリを利用するのでSPIの通信に関する関数を書き換える必要があります。&lt;/p&gt;
&lt;h2 id=&#34;stmマイコンの基本的な設定&#34;&gt;STMマイコンの基本的な設定&lt;/h2&gt;
&lt;h3 id=&#34;ピン設定&#34;&gt;ピン設定&lt;/h3&gt;
&lt;p&gt;ターゲットマイコンにSTM31L452RETxを選択&lt;/p&gt;
&lt;img src=&#34;pin_config.png&#34; width=&#34;500&#34;&gt;
&lt;h2 id=&#34;推論ネットワークの初期化コードの設定&#34;&gt;推論ネットワークの初期化コードの設定&lt;/h2&gt;
&lt;p&gt;STMマイコンに深層学習を実装するにはSTマイクロ社が用意しているツール(&lt;a href=&#34;https://www.st.com/ja/embedded-software/x-cube-ai.html&#34;&gt;X-CUBE-AI&lt;/a&gt;)を利用するのが一番手軽に実装できます。&lt;br&gt;
さらに同社からAIアプリケーション用の便利な関数パック(&lt;a href=&#34;https://www.st.com/ja/embedded-software/fp-ai-vision1.html#overview&#34;&gt;FP-AI-VISION1&lt;/a&gt;)が配布されています。&lt;br&gt;
この中にExampleとして人物検出用の学習済みネットワークが含まれていますので，これを今回の推論ネットワークとして利用しました。&lt;/p&gt;
&lt;h3 id=&#34;x-cube-aiのインストール&#34;&gt;X-CUBE-AIのインストール&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.st.com/ja/embedded-software/x-cube-ai.html&#34;&gt;X-CUBE-AI&lt;/a&gt;はオプションのツールなので，IDEへ導入する必要があります。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;はじめに&lt;code&gt;Manage Software Packs&lt;/code&gt;をクリックしてください。&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;click_manage_software_packs.png&#34; width=&#34;500&#34;&gt;  
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Emmbedded Software Packages Manager&lt;/code&gt;というウィンドウが開かれます。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;STMicroelectronics&lt;/code&gt;というタブを選択します。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;X-CUBE-AI&lt;/code&gt;をクリックすると様々なバージョンの&lt;code&gt;Artificial Intelligence&lt;/code&gt;が表示されますので，導入したいバージョンのチェックボックをクリックし，下の&lt;code&gt;Install Now&lt;/code&gt;ボタンをクリックしてインストールしてください。&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;install_x-cube-ai.png&#34; width=&#34;500&#34;&gt;
&lt;h3 id=&#34;ニューラルネットワーク用の設定&#34;&gt;ニューラルネットワーク用の設定&lt;/h3&gt;
&lt;p&gt;ダウンロードしたFP_AI_VISION1の中に人物検出ネットワークが入っています。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FP_AI_VISION1/Utilities/AI_resources/PersonDetection/Google_Model/person_detect.tflite&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これを次の手順でX-CUBE-AIに読みこませます。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Pinout &amp;amp; Configuration&lt;/code&gt;のタブをクリック&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Software Packs&lt;/code&gt;を選択&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Configuration&lt;/code&gt;が開かれるので，networkのタブをクリック&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Model inputs&lt;/code&gt;にネットワーク情報を入力します
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;choose model&lt;/code&gt;: &lt;code&gt;TFLite&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Saved Model&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Model&lt;/code&gt;: 先ほどのFP_AI_VISION1内のネットワークファイルを指定&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ネットワークの圧縮と検証用の設定を入力します
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Compression&lt;/code&gt;: &lt;code&gt;None&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Validation inputs&lt;/code&gt;: &lt;code&gt;Random numbers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Validation outputs&lt;/code&gt;: &lt;code&gt;None&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;analyze_network.png&#34; width=&#34;500&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Analyze&lt;/code&gt;ボタンをクリックすると解析が始まります&lt;/li&gt;
&lt;li&gt;以下の画面が出れば完了です&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;analyzing_network.png&#34; width=&#34;500&#34;&gt;
&lt;ul&gt;
&lt;li&gt;最後に，設定した内容でコードが生成されるように&lt;code&gt;Mode&lt;/code&gt;で以下の箇所にチェックボックスにチェックを入れます
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Artificial Intelligence X-CUBE-AI&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Artificial Intelligence Application&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;初期化コードの生成&#34;&gt;初期化コードの生成&lt;/h2&gt;
&lt;p&gt;設定が完了したのでコードを生成します。&lt;br&gt;
&lt;code&gt;Project&lt;/code&gt; -&amp;gt; &lt;code&gt;Generate Code&lt;/code&gt;をクリックして生成してください。&lt;br&gt;
(Alt+Kでも生成できます。)&lt;/p&gt;
&lt;h2 id=&#34;プロジェクトの構成&#34;&gt;プロジェクトの構成&lt;/h2&gt;
&lt;p&gt;はじめにドライバや画像処理用のファイルを追加します。&lt;br&gt;
STM32CubeIDEの&lt;code&gt;Project Explorer&lt;/code&gt;を見ると次のフォルダが自動生成されていることが分かります。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Core&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Drivers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;X-CUBE-AI&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;まず&lt;code&gt;ArduCAM&lt;/code&gt;と&lt;code&gt;Pmod MTDS&lt;/code&gt;制御用のコードを&lt;code&gt;Driver&lt;/code&gt;に配置します。&lt;br&gt;
次に&lt;code&gt;FP_AI_VISION1&lt;/code&gt;内の画像処理用の便利な関数を利用したいので，以下のフォルダを作成します。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Middlewares&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ダウンロードした&lt;code&gt;FP_AI_VISION1&lt;/code&gt;内の&lt;code&gt;{FP_AI_VISION1}/Middlewares/ST/STM32_Image&lt;/code&gt;を作成した&lt;code&gt;Middlewares&lt;/code&gt;にインポートしてください。&lt;br&gt;
グレイスケールからRGB画像データに変換する関数や画サイズを変換する関数が用意されています。&lt;/p&gt;
&lt;p&gt;また，私は人物検出のネットワークのファイルを以下のように作成して入れました。&lt;br&gt;
これは読み込ませたニューラルネットワークのファイルを分かりやすい場所においておきたいだけで必須ではありません。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Utilities&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;推論実行部のコード&#34;&gt;推論実行部のコード&lt;/h2&gt;
&lt;p&gt;自動生成されたコードである&lt;code&gt;X-CUBE-AI/App&lt;/code&gt;内の&lt;code&gt;app_x-cube-ai.c&lt;/code&gt;のコード内に&lt;code&gt;MX_X_CUBE_AI_Process&lt;/code&gt;という関数があります。&lt;br&gt;
この関数内部で以下の関数が重要です。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;acquire_and_process_data()&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ネットワークに入力するデータを取得する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ai_run()&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;推論を実行する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;post_process()&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;推論実行後のデータに対する対応を記述&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;それぞれ以下のように実装しましょう&lt;br&gt;
ai_runはメモリ確保された入力データと出力データのポインタを渡して上げるだけで，自動生成されたコードだけで実行されます。&lt;br&gt;
ですからほぼ修正する必要がありません。とても便利ですね。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;acquire_and_process_data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;256&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;};&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Image_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Image_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;resizedImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Image_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;HAL_GetTick&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;captureBMP565&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;HAL_GetTick&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;sprintf&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34; Done : %lums&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;HAL_UART_Transmit&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;huart2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFFFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;

  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;width&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;width&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;height&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;height&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;ImgResize&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;resizedImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;NEAREST&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;ImgToGrayscale&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;resizedImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;else&lt;/span&gt;
  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;ImgToGrayscale&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;memcpy&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;pData&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;INPUT_IMG_HEIGHT&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;INPUT_IMG_WIDTH&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;

  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;ai_run&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data_in&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data_out&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;ai_i32&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;batch&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;ai_buffer&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ai_input&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;network_info&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;inputs&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;ai_buffer&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ai_output&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;network_info&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;outputs&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;ai_input&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;].&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;AI_HANDLE_PTR&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data_in&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;ai_output&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;].&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;AI_HANDLE_PTR&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data_out&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;batch&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;ai_network_run&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;network&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;ai_input&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;ai_output&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;batch&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;ai_log_err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ai_network_get_error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;network&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt;
        &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;ai_network_run&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;

  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;post_process&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;256&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;};&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Image_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;inputImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;extern&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Image_t&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#if defined(USE_PMODMTDS)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;HAL_GetTick&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;displayReInit&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;displayImage&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;120&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;height&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;160&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;cameraImg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;width&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;

  &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;HAL_GetTick&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;sprintf&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;Done : %lums&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;eTime&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;sTime&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
  &lt;span style=&#34;color:#000&#34;&gt;HAL_UART_Transmit&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;huart2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;eMsg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFFFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#endif
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;
  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;]))&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;______ Person Detected!!&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_UART_Transmit&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;huart2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFFFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_GPIO_WritePin&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;GPIOB&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;GPIO_PIN_10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;GPIO_PIN_SET&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#if defined(USE_BUZZER)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;myPWMStart&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;500&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_Delay&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;myPWMStop&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_Delay&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;myPWMStart&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;500&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_Delay&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;myPWMStop&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#endif
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#if defined(USE_PMODMTDS)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;displayPersonDetected&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#endif
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;______ No Person&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;\r\n\r\n&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_UART_Transmit&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;huart2&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;uint8_t&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;sizeof&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;msg&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0xFFFF&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
    &lt;span style=&#34;color:#000&#34;&gt;HAL_GPIO_WritePin&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;GPIOB&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;GPIO_PIN_10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;GPIO_PIN_RESET&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#if defined(USE_BUZZER)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;myPWMStop&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#endif
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#if defined(USE_PMODMTDS)
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#000&#34;&gt;displayNoPersonDetected&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt;
&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#endif
&lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;

  &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;この3つの関数は自動生成されたコードに修正を加えなくても&lt;code&gt;main.cpp&lt;/code&gt;から勝手に呼び出され，ずっとループ実行されます。&lt;br&gt;
各種インタフェースのドライバの初期化コードを&lt;code&gt;main.cpp&lt;/code&gt;に追加し，以上のようにデータの取得時の動作と推論実行後の動作を記述してあげるだけで，実装は終了です。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: LTE-Mを使ったIoTサービス</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/lte-m_soracom_1/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/lte-m_soracom_1/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;屋外のセンサデータを一定間隔で取得し、クラウドのダッシュボードで確認したり、異常値をメールやLINEで知る一般的なIoTサービスが、KDDIが開発した「LTE-M&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;リーフ」を使えば、簡単に実現出来ます。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;Example_LTE-M_v0.png&#34; alt=&#34;Example_LTE-M_v0.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;kddilte-mリーフの特長&#34;&gt;KDDI「LTE-Mリーフ」の特長&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;KDDI は、約23×30mmと超小型でLTE-M 通信機能に対応したLTE-Mリーフの開発に成功しました。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;小さな基板上に、データ通信用のアンテナを内蔵し（技適取得済）、外部アンテナは不要です。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;SIMカードは、&lt;a href=&#34;https://biz.kddi.com/service/iot-lpwa/&#34; target=&#34;_brank&#34;&gt; KDDIのLTE-M通信網&lt;/a&gt;に対応したソラコムのLTE-Mサービス「SORACOM Air for セルラー(plan-KM1)」が利用出来ます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;省電力性能は、通信モジュールが具備するスリープ等の機能だけでなく、ソフトウェア設定で通信モジュールへの給電自体を遮断する機能を搭載しており、長期間使用しない時は電池の消費を限りなくゼロに近づけることが可能にしました。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;電池は、単3電池やリチウムイオン電池等で、データ送信の頻度や回数等のユースケースに応じて選択することが出来ます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;電池寿命は約200日&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;です。&lt;/li&gt;
&lt;li&gt;毎月の通信量は従量制です。(作成中)&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;h1 id=&#34;leafonyの設定&#34;&gt;Leafonyの設定&lt;/h1&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac04/&#34; target=&#34;_brank&#34;&gt; LTE-M King M&lt;/a&gt;、
&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05/&#34; target=&#34;_brank&#34;&gt; LTE-M King S&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://soracom.jp/store/5263/&#34; target=&#34;_brank&#34;&gt; SORACOM IoT SIM(plan-KM1)&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.leafony.com/docs/products/basic2/&#34; target=&#34;_brank&#34;&gt; Basic Kit 2&lt;/a&gt;、&lt;a href=&#34;https://docs.leafony.com/docs/products/nut/&#34; target=&#34;_brank&#34;&gt; Nut Plate&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;開発用パソコン&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;単3ニッケル⽔素電池x3本&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;単3x3本電池ボックス(JST製PHコネクタ付き)&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;./lte-m_soracom_socket_large.jpg&#34;&gt;&lt;img src=&#34;./lte-m_soracom_socket_small.jpg&#34; width=&#34;250&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h2 id=&#34;ソースコード&#34;&gt;ソースコード&lt;/h2&gt;
&lt;h3 id=&#34;arduino-ideの場合&#34;&gt;Arduino IDEの場合&lt;/h3&gt;
&lt;p&gt;Leafonyのデータを送信する際の通信プロトコルは、TCPとUDPの二通りあり、Arduinoのスケッチだけでなく、 SORACOMの設定も異なります。また、TCPのスケッチは、テキストデータで送信する設定になっていますが、UDPのスケッチは、通信量を減らすため、バイナリーデータにしています。&lt;/a&gt;&lt;/br&gt;
初めての方は、TCPのスケッチがお勧めで、通信コストを抑えたい方は、UDPのをお使い下さい。&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_upload_tcp&#34; target=&#34;_brank&#34;&gt;  Arduinoソースコード(TCP用)&lt;/a&gt;　&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_upload_udp&#34; target=&#34;_brank&#34;&gt;  Arduinoソースコード(UDP用)&lt;/a&gt;　&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;platformio-ideの場合&#34;&gt;PlatformIO IDEの場合&lt;/h3&gt;
&lt;p&gt;PlatformIO IDE for VSCodeの設定の仕方は、&lt;a href=&#34;https://docs.leafony.com/docs/environment/stm32/platformio/&#34;&gt;こちら&lt;/a&gt;を参照願います。&lt;/br&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_4-Sensors_upload_tcp_Pjt&#34;&gt;PlatformIOソースコード(TCP用)&lt;/a&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Leafony/platformio-sample-projects/tree/main/stm32/STM32_4-Sensors_upload_udp_Pjt&#34;&gt;PlatformIOソースコード(UDP用)&lt;/a&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;leafonyの構成&#34;&gt;Leafonyの構成&lt;/h2&gt;
&lt;p&gt;このサンプルでは下記のリーフ構成で試せます。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Q&amp;rsquo;ty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AZ62&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;Connector Cover&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;コネクタカバー&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AI01&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;4-Sensors&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;温度、湿度、照度、加速度センサを搭載したリーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AP03&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;STM32 MCU&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;STM32L452REシリーズを使用した32bit MCUリーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AC04&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac04&#34;&gt;LTE-M King M&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;LTE-M (LTE Cat-M1)リーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AV05&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05&#34;&gt;LTE-M King S&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;LTE-M用電源リーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AZ63&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az63&#34;&gt;Nut Plate&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;固定金具&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;IoT SIM(plan-KM1)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;M2*18mm screw&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;単3x3本電池ボックス&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;単3ニッケル⽔素電池 　&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;リーフの組み立て&#34;&gt;リーフの組み立て&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;IoT SIM(plan-KM1)をLTE-M King MのnanoSIM card slotに差し込んで下さい。&lt;/li&gt;
&lt;li&gt;上から4-Sensorsリーフ、STM32 MCUリーフ、LTE-M King Mリーフ、LTE-M King Sリーフの順番で組み立て、ネジ止めして下さい。&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;./lte-m_soracom_block.jpg&#34;&gt;&lt;img src=&#34;./lte-m_soracom_block.jpg&#34; width=&#34;250&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h2 id=&#34;usbドライバーのインストール&#34;&gt;USBドライバーのインストール&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Arduinoのスケッチは、LTE-M King Sリーフを使って書き込んで下さい。LTE-M king SリーフのUSB-UART変換ICは、調達の都合上、MaxLinear社のIC(XR21B1411IL16-F)を採用しました。インストール方法は、&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05/#usb%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&#34; target=&#34;_brank&#34;&gt; こちらを&lt;/a&gt;参照して下さい。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;スケッチの書き込み&#34;&gt;スケッチの書き込み&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.leafony.com/docs/environment/stm32/arduino_ide/&#34; target=&#34;_brank&#34;&gt; STM32 MCUのArduino IDE設定&lt;/a&gt;が、まだ済んでない方は、インストールして下さい。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Arduinoのボードは、ツール→ Board part number→ Leafony STM32 MCU(16MHz)を選択します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Arduinoのスケッチを書き込んで下さい。&lt;/li&gt;
&lt;li&gt;STM32RTC.hでコンパイルエラーが発生した時は、STM32RTC.hのバージョンを最新から1.2.0または、1.1.0に変更すると改善された事例があります。&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;h1 id=&#34;soracomの設定&#34;&gt;SORACOMの設定&lt;/h1&gt;
&lt;p&gt;SORACOMは、複数のSIMを束ねたSIMグループで、クラウドの設定をします。以下の手順で、SORACOM上に送信したデータを確認することが出来ます。&lt;/p&gt;
&lt;h2 id=&#34;simグループの設定をする&#34;&gt;SIMグループの設定をする&lt;/h2&gt;
&lt;h3 id=&#34;tcpの場合のsimグループの設定&#34;&gt;TCPの場合のSIMグループの設定&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　SIMグループ　→　追加&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon&lt;/code&gt;（例）とします。&lt;/li&gt;
&lt;li&gt;SORACOM Air for セルラー設定の&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/get-location-info/#%e3%83%87%e3%83%90%e3%82%a4%e3%82%b9%e3%81%ae%e7%b0%a1%e6%98%93%e7%9a%84%e3%81%aa%e4%bd%8d%e7%bd%ae%e6%83%85%e5%a0%b1-%e7%b0%a1%e6%98%93%e4%bd%8d%e7%bd%ae%e6%b8%ac%e4%bd%8d%e6%a9%9f%e8%83%bd-%e3%82%92%e9%80%81%e4%bf%a1%e3%81%99%e3%82%8b&#34; target=&#34;_brank&#34;&gt; 簡易位置情報&lt;/a&gt;をONにします。&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Data設定をONにする。&lt;/li&gt;
&lt;li&gt;Unified Endpoint設定が、Auto(デフォルト)であることを確認します。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;udpの場合のsimグループの設定&#34;&gt;UDPの場合のSIMグループの設定&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　SIMグループ　→　追加&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon_udp&lt;/code&gt;（例）とします。&lt;/li&gt;
&lt;li&gt;SORACOM Air for セルラー設定の&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/get-location-info/#%e3%83%87%e3%83%90%e3%82%a4%e3%82%b9%e3%81%ae%e7%b0%a1%e6%98%93%e7%9a%84%e3%81%aa%e4%bd%8d%e7%bd%ae%e6%83%85%e5%a0%b1-%e7%b0%a1%e6%98%93%e4%bd%8d%e7%bd%ae%e6%b8%ac%e4%bd%8d%e6%a9%9f%e8%83%bd-%e3%82%92%e9%80%81%e4%bf%a1%e3%81%99%e3%82%8b&#34; target=&#34;_brank&#34;&gt; 簡易位置情報&lt;/a&gt;と&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/binary-parser/&#34; target=&#34;_brank&#34;&gt; バイナリーパーサ&lt;/a&gt;をONにし、フォーマットに下記を入力します。&lt;/br&gt;
&lt;code&gt;Temperature:0:float:32 Humidity:4:float:32 Illuminance:8:float:32 Battery_Level:12:float:32 Signal_Power:16:float:32&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Data設定をONにする。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Unified Endpoint設定&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;フォーマットは、&lt;code&gt;カスタム&lt;/code&gt;を選択します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;成功時のレスポンスのHTTP ステータスコードは&lt;code&gt;200&lt;/code&gt;を選択、CONTENT-TYPE ヘッダーの値は&lt;code&gt;text/plan&lt;/code&gt;　を入力、ステータスコードのボックスにチェック（レ点）を入れてます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;失敗時のレスポンスは、ステータスコードのボックスにチェック（レ点）を入れます。&lt;/br&gt;
&lt;img src=&#34;unified_endpoint.png&#34; alt=&#34;unified_endpoint.png&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;iot-simを登録する&#34;&gt;IoT SIMを登録する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　発注 &lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;注文履歴に購入したSIMを確認し、&lt;code&gt;受け取り確認 &lt;/code&gt;を押します。&lt;/br&gt;
&lt;img src=&#34;sim_1.png&#34; alt=&#34;sim_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;以下の画面が出てくるので&lt;code&gt;登録する &lt;/code&gt;を押します。
&lt;img src=&#34;sim_2.png&#34; alt=&#34;sim_2.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;左上の&lt;code&gt;メニュー　→　SIM管理 &lt;/code&gt;をクリック、。&lt;/br&gt;
&lt;img src=&#34;sim_4.png&#34; alt=&#34;sim_4.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;名前を決め、グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon&lt;/code&gt;を選択します。
&lt;img src=&#34;sim_5.png&#34; alt=&#34;sim_5.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;iot-simの通信を開始する&#34;&gt;IoT SIMの通信を開始する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/set-expiry/&#34; target=&#34;_brank&#34;&gt; こちら&lt;/a&gt;を参照し、有効期限とアクションを設定します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
&lt;code&gt;操作 →　使用開始&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-harvest上でleafonyが送信したデータを確認する&#34;&gt;SORACOM Harvest上でLeafonyが送信したデータを確認する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Leafonyの電源をONにしてデータを送信します。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　データ収集・蓄積・可視化 → SORACOM Harvest Data&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Dataの左上のリソースからSIMを選択し、Leafonyが送付したデータが確認出来れば、正しくデータが送付されています。
&lt;img src=&#34;data_1.png&#34; alt=&#34;data_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-の利用料金について&#34;&gt;SORACOM の利用料金について&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;SORACOMの利用料金は、&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、右上の&lt;code&gt;オペレータ →　ご利用料金 &lt;/code&gt;で確認出来ます。&lt;/li&gt;
&lt;li&gt;通信料金は、従量制(0.55 円/KB)なので、設定金額を上回った時にオペレーターに通知がくる設定をしておくのがよろしいです。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-lagoon-ダッシュボードについて-&#34;&gt;SORACOM Lagoon (ダッシュボード)について 　　　&lt;/h2&gt;
&lt;p&gt;SORACOM Lagoon は、SORACOM Harvest Data に蓄積したデータを用いて、グラフ・地図などを使ったダッシュボードを作成いただけるサービスです。&lt;/br&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　データ収集・蓄積・可視化 → SORACOM Harvest Lagoon&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Lagoonの利用を開始するをクリックします。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_1.png&#34; alt=&#34;user_lagoon_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;プランを選択します。使用するプランに基づいて月額の利用料金が発生しますが、無料利用枠からでも始められます。&lt;/br&gt; 
&lt;img src=&#34;user_lagoon_2.png&#34; alt=&#34;user_lagoon_2.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;パスワードは、アカウント(オペレータ)作成時に設定したパスワードと同じ方でも構いません。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_3.png&#34; alt=&#34;user_lagoon_3.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Lagoonコンソールをクリックします。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_4.png&#34; alt=&#34;user_lagoon_4.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SORACOM Lagoonの画面を出てくることを確認して下さい。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_5.png&#34; alt=&#34;user_lagoon_5.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/lagoon-v2/&#34; target=&#34;_brank&#34;&gt; こちら&lt;/a&gt;を参照し、SORACOM Lagoonを始めて下さい。&lt;br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;LTEは通常使用している携帯電話・スマートフォン用広域無線通信規格のことで、LTE-Mはこの通信技術を応用し通信速度を下げて超低電力化している無線規格です。 &lt;/br&gt; &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;3000mAhの18650電池を使用し、1時間に1回データ送信した時の計算値 &lt;/br&gt; &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;写真の電池ボックスの購入先 &lt;/br&gt;
・単3x3本電池ボックス(秋月)：&lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-02667/&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-02667/&#34;&gt;https://akizukidenshi.com/catalog/g/gP-02667/&lt;/a&gt;&lt;/a&gt;　&lt;/br&gt;
・JST製PHコネクタ(秋月):&lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-12665/&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-12665/&#34;&gt;https://akizukidenshi.com/catalog/g/gP-12665/&lt;/a&gt;&lt;/a&gt;　&lt;/br&gt;
・接続コネクタ(エーモン)：&lt;a href=&#34;https://www.amon.jp/diy/index.php?diy_id=63&amp;mode=contents
&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://www.amon.jp/diy/index.php?diy_id=63&amp;amp;mode=contents&#34;&gt;https://www.amon.jp/diy/index.php?diy_id=63&amp;amp;mode=contents&lt;/a&gt; &lt;/a&gt;&lt;/br&gt; &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;　STM32RTC.hでコンパイルエラーのログ&lt;/br&gt;
&lt;a href=&#34;./STM32RTC_ERR0R.jpg&#34;&gt;&lt;img src=&#34;./STM32RTC_ERR0R.jpg&#34;&gt;&lt;/a&gt;&lt;/br&gt; &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;

      </description>
    </item>
    
    <item>
      <title>Docs: LTE-Mを使ったAWS IoTサービス（仕掛中）</title>
      <link>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/lte-m_aws_1/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://docs.leafony.com/docs/examples/advanced/3_p/stm32/lte-m_aws_1/</guid>
      <description>
        
        
        &lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;
&lt;p&gt;屋外のセンサデータを一定間隔で取得し、クラウドのダッシュボードで確認したり、異常値をメールやLINEで知る一般的なIoTサービスが、KDDIが開発した「LTE-M&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;リーフ」を使えば、簡単に実現出来ます。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;setting_block.png&#34; alt=&#34;setting_block.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;kddilte-mリーフの特長&#34;&gt;KDDI「LTE-Mリーフ」の特長&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;KDDI は、約23×30mmと超小型でLTE-M 通信機能に対応したLTE-Mリーフの開発に成功しました。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;小さな基板上に、データ通信用のアンテナを内蔵し（技適取得済）、外部アンテナは不要です。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;SIMカードは、&lt;a href=&#34;https://biz.kddi.com/service/iot-lpwa/&#34; target=&#34;_brank&#34;&gt; KDDIのLTE-M通信網&lt;/a&gt;に対応したソラコムのLTE-Mサービス「SORACOM Air for セルラー(plan-KM1)」が利用出来ます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;省電力性能は、通信モジュールが具備するスリープ等の機能だけでなく、ソフトウェア設定で通信モジュールへの給電自体を遮断する機能を搭載しており、長期間使用しない時は電池の消費を限りなくゼロに近づけることが可能にしました。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;電池は、単3電池やリチウムイオン電池等で、データ送信の頻度や回数等のユースケースに応じて選択することが出来ます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;電池寿命は約200日&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;です。&lt;/li&gt;
&lt;li&gt;毎月の通信量は従量制です。(作成中)&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;h1 id=&#34;leafonyの設定&#34;&gt;Leafonyの設定&lt;/h1&gt;
&lt;h2 id=&#34;用意するもの&#34;&gt;用意するもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac04/&#34; target=&#34;_brank&#34;&gt; LTE-M King M&lt;/a&gt;、
&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05/&#34; target=&#34;_brank&#34;&gt; LTE-M King S&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://soracom.jp/store/5263/&#34; target=&#34;_brank&#34;&gt; SORACOM IoT SIM(plan-KM1)&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.leafony.com/docs/products/basic2/&#34; target=&#34;_brank&#34;&gt; Basic Kit 2&lt;/a&gt;、&lt;a href=&#34;https://docs.leafony.com/docs/products/nut/&#34; target=&#34;_brank&#34;&gt; Nut Plate&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;開発用パソコン&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;単3ニッケル⽔素電池x3本&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;単3x3本電池ボックス(JST製PHコネクタ付き)&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;./lte-m_soracom_socket_large.jpg&#34;&gt;&lt;img src=&#34;./lte-m_soracom_socket_small.jpg&#34; width=&#34;250&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h2 id=&#34;サンプルアプリのソースコード&#34;&gt;サンプルアプリのソースコード&lt;/h2&gt;
&lt;p&gt;Leafonyのデータを送信する際の通信プロトコルは、TCPとUDPの二通りあり、Arduinoのスケッチだけでなく、 SORACOMの設定も異なります。また、TCPのスケッチは、テキストデータで送信する設定になっていますが、UDPのスケッチは、通信量を減らすため、バイナリーデータにしています。&lt;/a&gt;&lt;/br&gt;
初めての方は、TCPのスケッチがお勧めで、通信コストを抑えたい方は、UDPのをお使い下さい。&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_upload_tcp&#34; target=&#34;_brank&#34;&gt;  Arduino スケッチ(TCP用)&lt;/a&gt;　&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Leafony/Sample-Sketches/tree/master/STM32_4-Sensors_upload_udp&#34; target=&#34;_brank&#34;&gt;  Arduino スケッチ(UDP用)&lt;/a&gt;　&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;leafonyの構成&#34;&gt;Leafonyの構成&lt;/h2&gt;
&lt;p&gt;このサンプルでは下記のリーフ構成で試せます。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Q&amp;rsquo;ty&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AZ62&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az62&#34;&gt;Connector Cover&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;コネクタカバー&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AI01&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/io/ai01&#34;&gt;4-Sensors&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;温度、湿度、照度、加速度センサを搭載したリーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AP03&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/processor/ap03&#34;&gt;STM32 MCU&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;STM32L452REシリーズを使用した32bit MCUリーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AC04&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac04&#34;&gt;LTE-M King M&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;LTE-M (LTE Cat-M1)リーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AV05&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05&#34;&gt;LTE-M King S&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;LTE-M用電源リーフ&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AZ63&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://docs.leafony.com/docs/leaf/others/az63&#34;&gt;Nut Plate&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;固定金具&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;IoT SIM(plan-KM1)&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;M2*18mm screw&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;単3x3本電池ボックス&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;単3ニッケル⽔素電池 　&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;リーフの組み立て&#34;&gt;リーフの組み立て&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;IoT SIM(plan-KM1)をLTE-M King MのnanoSIM card slotに差し込んで下さい。&lt;/li&gt;
&lt;li&gt;上から4-Sensorsリーフ、STM32 MCUリーフ、LTE-M King Mリーフ、LTE-M King Sリーフの順番で組み立て、ネジ止めして下さい。&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;./lte-m_soracom_block.jpg&#34;&gt;&lt;img src=&#34;./lte-m_soracom_block.jpg&#34; width=&#34;250&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;
&lt;h2 id=&#34;usbドライバーのインストール&#34;&gt;USBドライバーのインストール&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Arduinoのスケッチは、LTE-M King Sリーフを使って書き込んで下さい。LTE-M king SリーフのUSB-UART変換ICは、調達の都合上、MaxLinear社のIC(XR21B1411IL16-F)を採用しました。インストール方法は、&lt;a href=&#34;https://docs.leafony.com/docs/leaf/communication/ac05/#usb%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB&#34; target=&#34;_brank&#34;&gt; こちらを&lt;/a&gt;参照して下さい。
&lt;a href=&#34;./lte-m_soracom_block_large.jpg&#34;&gt;&lt;img src=&#34;./lte-m_soracom_block_small.jpg&#34; width=&#34;300&#34;&gt;&lt;/a&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;スケッチの書き込み&#34;&gt;スケッチの書き込み&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.leafony.com/docs/environment/stm32/arduino_ide/&#34; target=&#34;_brank&#34;&gt; STM32 MCUのArduino IDE設定&lt;/a&gt;が、まだ済んでない方は、インストールして下さい。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Arduinoのボードは、ツール→ Board part number→ Leafony STM32 MCU(16MHz)を選択します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Arduinoのスケッチ[^4]を書き込んで下さい。&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;h1 id=&#34;awsの設定-以下要変更&#34;&gt;AWSの設定 ※以下、要変更&lt;/h1&gt;
&lt;p&gt;AWSは、複数のSIMを束ねたSIMグループで、クラウドの設定をします。以下の手順で、SORACOM上に送信したデータを確認することが出来ます。&lt;/p&gt;
&lt;h2 id=&#34;awsの設定をするbr&#34;&gt;AWSの設定をする&lt;/br&gt;&lt;/h2&gt;
&lt;p&gt;仕掛中&lt;/br&gt;&lt;/p&gt;
&lt;h3 id=&#34;tcpの場合のsimグループの設定&#34;&gt;TCPの場合のSIMグループの設定&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　SIMグループ　→　追加&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon&lt;/code&gt;（例）とします。&lt;/li&gt;
&lt;li&gt;SORACOM Air for セルラー設定の&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/get-location-info/#%e3%83%87%e3%83%90%e3%82%a4%e3%82%b9%e3%81%ae%e7%b0%a1%e6%98%93%e7%9a%84%e3%81%aa%e4%bd%8d%e7%bd%ae%e6%83%85%e5%a0%b1-%e7%b0%a1%e6%98%93%e4%bd%8d%e7%bd%ae%e6%b8%ac%e4%bd%8d%e6%a9%9f%e8%83%bd-%e3%82%92%e9%80%81%e4%bf%a1%e3%81%99%e3%82%8b&#34; target=&#34;_brank&#34;&gt; 簡易位置情報&lt;/a&gt;をONにします。&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Data設定をONにする。&lt;/li&gt;
&lt;li&gt;Unified Endpoint設定が、Auto(デフォルト)であることを確認します。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;udpの場合のsimグループの設定&#34;&gt;UDPの場合のSIMグループの設定&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　SIMグループ　→　追加&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon_udp&lt;/code&gt;（例）とします。&lt;/li&gt;
&lt;li&gt;SORACOM Air for セルラー設定の&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/get-location-info/#%e3%83%87%e3%83%90%e3%82%a4%e3%82%b9%e3%81%ae%e7%b0%a1%e6%98%93%e7%9a%84%e3%81%aa%e4%bd%8d%e7%bd%ae%e6%83%85%e5%a0%b1-%e7%b0%a1%e6%98%93%e4%bd%8d%e7%bd%ae%e6%b8%ac%e4%bd%8d%e6%a9%9f%e8%83%bd-%e3%82%92%e9%80%81%e4%bf%a1%e3%81%99%e3%82%8b&#34; target=&#34;_brank&#34;&gt; 簡易位置情報&lt;/a&gt;と&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/binary-parser/&#34; target=&#34;_brank&#34;&gt; バイナリーパーサ&lt;/a&gt;をONにし、フォーマットに下記を入力します。&lt;/br&gt;
&lt;code&gt;Temperature:0:float:32 Humidity:4:float:32 Illuminance:8:float:32 Battery_Level:12:float:32 Signal_Power:16:float:32&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Data設定をONにする。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;Unified Endpoint設定&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;フォーマットは、&lt;code&gt;カスタム&lt;/code&gt;を選択します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;成功時のレスポンスのHTTP ステータスコードは&lt;code&gt;200&lt;/code&gt;を選択、CONTENT-TYPE ヘッダーの値は&lt;code&gt;text/plan&lt;/code&gt;　を入力、ステータスコードのボックスにチェック（レ点）を入れてます。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;失敗時のレスポンスは、ステータスコードのボックスにチェック（レ点）を入れます。&lt;/br&gt;
&lt;img src=&#34;unified_endpoint.png&#34; alt=&#34;unified_endpoint.png&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;iot-simを登録する&#34;&gt;IoT SIMを登録する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　発注 &lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;注文履歴に購入したSIMを確認し、&lt;code&gt;受け取り確認 &lt;/code&gt;を押します。&lt;/br&gt;
&lt;img src=&#34;sim_1.png&#34; alt=&#34;sim_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;以下の画面が出てくるので&lt;code&gt;登録する &lt;/code&gt;を押します。
&lt;img src=&#34;sim_2.png&#34; alt=&#34;sim_2.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;左上の&lt;code&gt;メニュー　→　SIM管理 &lt;/code&gt;をクリック、。&lt;/br&gt;
&lt;img src=&#34;sim_4.png&#34; alt=&#34;sim_4.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;名前を決め、グループ名は、&lt;code&gt;KM-1_SORACOM-Lagoon&lt;/code&gt;を選択します。
&lt;img src=&#34;sim_5.png&#34; alt=&#34;sim_5.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;iot-simの通信を開始する&#34;&gt;IoT SIMの通信を開始する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/air/set-expiry/&#34; target=&#34;_brank&#34;&gt; こちら&lt;/a&gt;を参照し、有効期限とアクションを設定します。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
&lt;code&gt;操作 →　使用開始&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-harvest上でleafonyが送信したデータを確認する&#34;&gt;SORACOM Harvest上でLeafonyが送信したデータを確認する&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Leafonyの電源をONにしてデータを送信します。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　データ収集・蓄積・可視化 → SORACOM Harvest Data&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/li&gt;
&lt;li&gt;SORACOM Harvest Dataの左上のリソースからSIMを選択し、Leafonyが送付したデータが確認出来れば、正しくデータが送付されています。
&lt;img src=&#34;data_1.png&#34; alt=&#34;data_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-の利用料金について&#34;&gt;SORACOM の利用料金について&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;SORACOMの利用料金は、&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、右上の&lt;code&gt;オペレータ →　ご利用料金 &lt;/code&gt;で確認出来ます。&lt;/li&gt;
&lt;li&gt;通信料金は、従量制(0.55 円/KB)なので、設定金額を上回った時にオペレーターに通知がくる設定をしておくのがよろしいです。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;soracom-lagoon-ダッシュボードについて-&#34;&gt;SORACOM Lagoon (ダッシュボード)について 　　　&lt;/h2&gt;
&lt;p&gt;SORACOM Lagoon は、SORACOM Harvest Data に蓄積したデータを用いて、グラフ・地図などを使ったダッシュボードを作成いただけるサービスです。&lt;/br&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://console.soracom.io/&#34; target=&#34;_brank&#34;&gt; ユーザコンソール&lt;/a&gt;を開き、
左上の&lt;code&gt;メニュー　→　データ収集・蓄積・可視化 → SORACOM Harvest Lagoon&lt;/code&gt;をクリックします。&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Lagoonの利用を開始するをクリックします。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_1.png&#34; alt=&#34;user_lagoon_1.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;プランを選択します。使用するプランに基づいて月額の利用料金が発生しますが、無料利用枠からでも始められます。&lt;/br&gt; 
&lt;img src=&#34;user_lagoon_2.png&#34; alt=&#34;user_lagoon_2.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;パスワードは、アカウント(オペレータ)作成時に設定したパスワードと同じ方でも構いません。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_3.png&#34; alt=&#34;user_lagoon_3.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Lagoonコンソールをクリックします。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_4.png&#34; alt=&#34;user_lagoon_4.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SORACOM Lagoonの画面を出てくることを確認して下さい。&lt;/br&gt;
&lt;img src=&#34;user_lagoon_5.png&#34; alt=&#34;user_lagoon_5.png&#34;&gt;&lt;/br&gt;&lt;/br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://users.soracom.io/ja-jp/docs/lagoon-v2/&#34; target=&#34;_brank&#34;&gt; こちら&lt;/a&gt;を参照し、SORACOM Lagoonを始めて下さい。&lt;br&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p style=&#34;text-align: right&#34;&gt;
&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;LTEは通常使用している携帯電話・スマートフォン用広域無線通信規格のことで、LTE-Mはこの通信技術を応用し通信速度を下げて超低電力化している無線規格です。 &lt;/br&gt; &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;3000mAhの18650電池を使用し、1時間に1回データ送信した時の計算値 &lt;/br&gt; &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;写真の電池ボックスの購入先 &lt;/br&gt;
・単3x3本電池ボックス(秋月)：&lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-02667/&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-02667/&#34;&gt;https://akizukidenshi.com/catalog/g/gP-02667/&lt;/a&gt;&lt;/a&gt;　&lt;/br&gt;
・JST製PHコネクタ(秋月):&lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-12665/&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://akizukidenshi.com/catalog/g/gP-12665/&#34;&gt;https://akizukidenshi.com/catalog/g/gP-12665/&lt;/a&gt;&lt;/a&gt;　&lt;/br&gt;
・接続コネクタ(エーモン)：&lt;a href=&#34;https://www.amon.jp/diy/index.php?diy_id=63&amp;mode=contents
&#34; target=&#34;_brank&#34;&gt; &lt;a href=&#34;https://www.amon.jp/diy/index.php?diy_id=63&amp;amp;mode=contents&#34;&gt;https://www.amon.jp/diy/index.php?diy_id=63&amp;amp;mode=contents&lt;/a&gt; &lt;/a&gt;&lt;/br&gt; &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;

      </description>
    </item>
    
  </channel>
</rss>
