<!doctype html>
<html lang="jp" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.69.0" />

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">

<link rel="alternate" type="application/rss&#43;xml" href="/docs/examples/lcd/index.xml">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>LCD | Leafony</title><meta property="og:title" content="LCD" />
<meta property="og:description" content="センサの値をLCDに表示させよう
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/examples/lcd/" />
<meta property="og:site_name" content="Leafony" />
<meta itemprop="name" content="LCD">
<meta itemprop="description" content="センサの値をLCDに表示させよう
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="LCD"/>
<meta name="twitter:description" content="センサの値をLCDに表示させよう
"/>





<link rel="preload" href="/scss/main.min.df56c929024b3d9666383e2051ce5b2c40bbcc1771c8ca30622b22efe754ec4e.css" as="style">
<link href="/scss/main.min.df56c929024b3d9666383e2051ce5b2c40bbcc1771c8ca30622b22efe754ec4e.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>


    <title>LCD | Leafony</title>
  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">Leafony</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">技術資料</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/leafony" target="_blank" ><span>Github</span></a>
			</li>
			
			
			
			<li class="nav-item dropdown d-lg-block">
				

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Japanese
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/en/">English</a>
	
</div>
			</li>
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    <div class="nav-item dropdown d-block d-lg-none">
      

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Japanese
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/en/">English</a>
	
</div>
    </div>
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">技術資料</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">はじめに</a>
  </li>
  <ul>
    <li class="collapse " id="docsoverview">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/overview/terms/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">用語の説明</a>
  </li>
  <ul>
    <li class="collapse " id="docsoverviewterms">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/getting-started/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">クイックスタート</a>
  </li>
  <ul>
    <li class="collapse " id="docsgetting-started">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/getting-started/basic/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Basic Kit A1.0</a>
  </li>
  <ul>
    <li class="collapse " id="docsgetting-startedbasic">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/getting-started/esp32/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ESP32 Wi-Fi Kit A1.0</a>
  </li>
  <ul>
    <li class="collapse " id="docsgetting-startedesp32">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/environment/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">開発環境設定</a>
  </li>
  <ul>
    <li class="collapse " id="docsenvironment">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/environment/basic/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Basic Kit</a>
  </li>
  <ul>
    <li class="collapse " id="docsenvironmentbasic">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/environment/esp32/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ESP32 Wi-Fi Kit</a>
  </li>
  <ul>
    <li class="collapse " id="docsenvironmentesp32">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">サンプルデザイン</a>
  </li>
  <ul>
    <li class="collapse show" id="docsexamples">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/blink/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">LED点滅</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesblink">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/camera/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">カメラの撮影</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplescamera">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/distance_sensor/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">超音波センサで距離測定</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesdistance_sensor">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/read_battery/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">バッテリ残量</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesread_battery">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/temp_humid_sensors/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">温湿度センサ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplestemp_humid_sensors">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/illum_sensor/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">照度センサ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesillum_sensor">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/accelerometer/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">加速度センサ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesaccelerometer">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/webbluetooth_iot/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Web Bluetooth</a>
  </li>
  <ul>
    <li class="collapse " id="docsexampleswebbluetooth_iot">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/google_sheets_iot/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Google Sheets</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesgoogle_sheets_iot">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/speaker/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">スピーカ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesspeaker">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/sound_level/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">サウンドレベルメータ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplessound_level">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/wifi_touchsensor/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Wi-Fi タッチセンサ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexampleswifi_touchsensor">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/ir_sensor/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">人感センサ</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesir_sensor">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/lcd/" class="align-left pl-0 pr-2 collapsed active td-sidebar-link td-sidebar-link__section">LCD</a>
  </li>
  <ul>
    <li class="collapse " id="docsexampleslcd">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/rtc/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">リアルタイムクロック</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesrtc">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/examples/microsd/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Micro SD</a>
  </li>
  <ul>
    <li class="collapse " id="docsexamplesmicrosd">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">リーフ資料</a>
  </li>
  <ul>
    <li class="collapse " id="docsleaf">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/leafonybus/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Leafony bus</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafleafonybus">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ai01a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">4-Sensors</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafai01a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ap01a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">AVR MCU</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafap01a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ac03a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">LoRa Easy</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafac03a">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsleafac03a_index-2" href="/docs/leaf/ac03a/_index-2/">LoRa Easy</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ai02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">SP&amp;PIR</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafai02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ap02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ESP32 MCU</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafap02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/pcb_template/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">基板設計テンプレート</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafpcb_template">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ac02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">BLE Sugar</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafac02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ai03a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">MIC&amp;VR&amp;LED</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafai03a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ai04a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">LCD</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafai04a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/av01a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CR2032</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafav01a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/av02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CR2450</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafav02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/av03a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">AA BAT</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafav03a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/av04a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">2V～4.5V</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafav04a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax01a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Shield</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax01a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">29 pin</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax03a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Leaf x2</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax03a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax04a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Spacer</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax04a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax05a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">I Meas</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax05a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax06a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Grove&amp;5V</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax06a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax07a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Back to back</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax07a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/ax08a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">29pin header</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafax08a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az61a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Connector</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz61a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az01a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">USB</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz01a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az62a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Connector Cover</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz62a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az02a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RTC&amp;MicroSD</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz02a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az63a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Nut Plate</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz63a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az65a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Lowercase</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz65a">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/leaf/az64a/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Uppercase</a>
  </li>
  <ul>
    <li class="collapse " id="docsleafaz64a">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/license/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ライセンス・規約</a>
  </li>
  <ul>
    <li class="collapse " id="docslicense">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            









<nav id="TableOfContents">
  <ul>
    <li><a href="#概要">概要</a></li>
    <li><a href="#必要なハードウェアの準備">必要なハードウェアの準備</a></li>
    <li><a href="#リーフの組立">リーフの組立</a></li>
    <li><a href="#スケッチの書き込み">スケッチの書き込み</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/docs/">技術資料</a>
</li>




<li class="breadcrumb-item" >
	<a href="/docs/examples/">サンプルデザイン</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/docs/examples/lcd/">LCD</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>LCD</h1>
	<div class="lead">センサの値をLCDに表示させよう</div>
	<h2 id="概要">概要</h2>
<p>電源リーフには、電池電圧をモニタするためのADコンバータを実装。温度、湿度、照度、傾きだけでなく、電池電圧も測定し、LCDに表示させます。
温度（または、湿度）の補正の仕方
表示させたい温度（または、湿度）と４-Sensorsの温度（または、湿度）に、ずれがあるときは、２点間補正を行います。詳しくは、<a href="https://trillion-node.org/example/correction/">こちら</a>。</p>
<p><img src="./LCD_overview2.png" alt="assemble1"><img src="./LCD_overview.png" alt="overview"></p>
<h2 id="必要なハードウェアの準備">必要なハードウェアの準備</h2>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Q&rsquo;ty</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">AI04A</td>
<td align="left">LCD</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AI01A</td>
<td align="left">4-Sensors</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AP01A</td>
<td align="left">AVR MCU</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AZ01A</td>
<td align="left">USB</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AX03A</td>
<td align="left">Leaf×2</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AV01A</td>
<td align="left">CR2032</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">AZ62A</td>
<td align="left">Connector Cover</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">AZ63A</td>
<td align="left">Nut Plate</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">CR2032 3V Lithium coin cell battery</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Screw M2×25mm</td>
<td align="left">4</td>
</tr>
</tbody>
</table>
<h2 id="リーフの組立">リーフの組立</h2>
<p><img src="./LCD_assemble.png" alt="assemble1"></p>
<h2 id="スケッチの書き込み">スケッチの書き込み</h2>
<ul>
<li>書き込みには、4-Sensors、LCD、AVR MCUライブラリ（タイマ割り込み）が必要です。予め、ライブラリをインクルードしておいてください。詳しくは、[こちら]。</li>
<li>Arduino IDEで、以下のスケッチをマイコンボードに書き込んでください。
//=====================================================================
//  Leafony Platform sample sketch
//     Platform     : 4-Sensors
//     Processor    : ATmega328P (3.3V /8MHz)
//     Application  : 4-Sensors with LCD
//
//     Leaf configuration
//       (1) AI01 4-Sensors
//       (2) AI04 LCD
//       (3) AP01 AVR MCU
//       (4) AV02 CR2450 or AV01 CR2032
//       (5) AZ01 USB		(for debug)
//
//		(c) 2019  Trillion-Node Study Group
//		Released under the MIT license
//		https://opensource.org/licenses/MIT
//
//      Rev.00 2019/08/20 First release
//=====================================================================
//use libraries
//Adafruit LIS3DH
//https://github.com/adafruit/Adafruit_LIS3DH
//※  Adafruit_LIS3DH.h
//    uint8_t readRegister8(uint8_t reg);
//    void writeRegister8(uint8_t reg, uint8_t value);
//    をpublic:に移動する
//Adafruit Unified Sensor Driver
//https://github.com/adafruit/Adafruit_Sensor
//SmartEverything ST HTS221 Humidity Sensor
//https://github.com/ameltech/sme-hts221-library
//ClosedCube Arduino Library for ClosedCube OPT3001
//https://github.com/closedcube/ClosedCube_OPT3001_Arduino
//ST7032 - Arduino LiquidCrystal compatible library
//https://github.com/tomozh/arduino_ST7032
//=====================================================================</li>
</ul>
<p>//=====================================================================
// difinition
//=====================================================================
#include &lt;MsTimer2.h&gt;
#include &lt;avr/wdt.h&gt;
#include &lt;avr/sleep.h&gt;
#include &lt;avr/power.h&gt;</p>
<p>#include &lt;Wire.h&gt;
#include &lt;Adafruit_LIS3DH.h&gt; <br>
#include &lt;Adafruit_Sensor.h&gt;
#include &lt;HTS221.h&gt;
#include &lt;ClosedCube_OPT3001.h&gt;
#include &lt;SoftwareSerial.h&gt;
#include &lt;ST7032.h&gt;
//=====================================================================</p>
<p>//=====================================================================
// シリアルコンソールへのデバック出力
//      #define DEBUG = 出力あり
//　　//#define DEBUG = 出力なし（コメントアウトする）
//=====================================================================
#define DEBUG
//=====================================================================</p>
<p>//=====================================================================
// IOピンの名前定義
// 接続するリーフに合わせて定義する
//=====================================================================
// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// PD port
//     digital 0: PD0 = PCRX    (HW UART)
//     digital 1: PD1 = PCTX    (HW UART)
//     digital 2: PD2 = INT0#
//     digital 3: PD3 = INT1#
//     digital 4: PD4 = Reserved  /* not use */
//     digital 5: PD5 = Reserved  /* not use */
//     digital 6: PD6 = Reserved  /* not use */
//     digital 7: PD7 = Reserved  /* not use */
// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define PCTX  0
#define PCRX  1
#define INT0  2
#define INT1  3
#define RSV_D4  4    <br>
#define RSV_D5  5
#define RSV_D6  6
#define RSV_D7  7</p>
<p>// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// PB port
//     digital 8: PB0 = Reserved  /* not use */
//     digital 9: PB1 = Reserved  /* not use */
//     digital 10:PB2 = SS#
//     digital 11:PB3 = MOSI
//     digital 12:PB4 = MISO
//     digital 13:PB5 = SCK (LED)
//                PB6 = XTAL1
//                PB7 = XTAL2
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
#define RSV_D8  8
#define RSV_D9  9
#define SS      10
#define MOSI    11
#define MISO    12
#define LED_PIN     13</p>
<p>// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// PC port
//     digital 14/ Analog0: PC0 = Reserved  /* not use */
//     digital 15/ Analog1: PC1 = Reserved  /* not use */
//     digital 16/ Analog2: PC2 = Reserved  /* not use */
//     digital 17/ Analog3: PC3 = Reserved  /* not use */
//     digital 18/ SDA    : PC4 = SDA   (I2C)
//     digital 19/ SCL    : PC5 = SCL   (I2C)
//     RESET              : PC6 = RESET#
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define RSV_D14   14
#define RSV_D15   15
#define RSV_D16   16
#define RSV_D17   17
#define SDA       18
#define SCL       19</p>
<p>//=====================================================================
// プログラム内で使用する定数定義
// 
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//３軸センサ、輝度センサ I2Cアドレス
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define LIS2DH_ADDRESS 0x19       // SD0/SA0 pin = VCC 
#define OPT3001_ADDRESS 0x45      // ADDR pin = VCC
#define I2C_EXPANDER_ADDR_LCD   0x1A</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// loop() interval
// MsTimer2のタイマー割り込み発生間隔(ms)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define LOOP_INTERVAL 125         // 125ms interval</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// LIS2DH
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define DIVIDER_2G 16383          // full scale 2G  (=0xFFFF/4)
#define DIVIDER_4G 8191           // full scale 4G  (=0xFFFF/4/2)
#define DIVIDER_8G 4096           // full scale 8G  (=0xFFFF/4/4)
#define DIVIDER_16G 1365          // full scale 16G (=0xFFFF/4/12)</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// Batt ADC ADC081C027
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
#define BATT_ADC_ADDR 0x50</p>
<p>//=====================================================================
// object
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// Sensor
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
Adafruit_LIS3DH accel = Adafruit_LIS3DH();
ClosedCube_OPT3001 light;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// LCD
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
ST7032 lcd;</p>
<p>//=====================================================================
// プログラムで使用する変数定義
// 
//=====================================================================
//=====================================================================
// RAM data
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// loop counter
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
uint8_t iLoop1s = 0;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// event
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
bool eventSensorRead = false;
bool eventWriteLCD = false;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// int0 interrupt
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
volatile bool bEventSleep = false;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// interval Timer2 interrupt
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
volatile bool bInterval = false;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// LIS2DH : accelerometer
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
int16_t dataX, dataY, dataZ;
float dataX_g, dataY_g, dataZ_g;
float dataTilt, avrTilt;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// HTS221 : Temperature/Humidity
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
float dataTemp, avrTemp;
float dataHumid, avrHumid;
float calcTemp = 0;
float calcHumid = 0;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// 2点補正用データ
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// 温度補正用データ0
float TL0 = 25.0;     // 4-Sensors温度測定値
float TM0 = 25.0;     // 温度計等測定値
// 温度補正用データ1
float TL1 = 40.0;     // 4-Sensors温度測定値
float TM1 = 40.0;     // 温度計等測定値</p>
<p>// 湿度補正用データ0
float HL0 = 60.0;     // 4-Sensors湿度測定値
float HM0 = 60.0;     // 湿度計等測定値
// 湿度補正用データ1
float HL1 = 80.0;     // 4-Sensors湿度測定値
float HM1 = 80.0;     // 湿度計等測定値</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// OPT3001 : Light
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
float dataLight, avrLight;
float calcLight = 0;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// LCD
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
volatile bool  bLCDchange = false;
volatile int lcd_view_sts = 0;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// Sleep, Watchdog Timer
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>
<p>volatile int countWDT = 0;
volatile int wakeupWDT = 2;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// Batt
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
float dataBatt = 0;</p>
<p>//=====================================================================
// setup
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// port
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//=====================================================================
// IOピンの入出力設定
// 接続するリーフに合わせて設定する
//=====================================================================
void setupPort(){</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// PD port
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// PD0 : digital 0 = RX
// PD1 : digital 1 = TX</p>
<p>pinMode(INT0, INPUT);       // PD2 : digital 2 = BLE interrupt
pinMode(INT1, INPUT);       // PD3 : digital 3 = sensor interrupt</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// PB port
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
pinMode(LED_PIN, OUTPUT);       // PB5 : digital 13 = DEV _LED
digitalWrite(LED_PIN, LOW);
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// PC port
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// PC4 : digital 18 = I2C SDA
// PC5 : digital 19 = I2C SCL 
}
//=====================================================================
// 割り込み処理初期設定
// 
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// external interrupt
// 外部割り込み設定
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void setupExtInt(){</p>
<p>attachInterrupt(0, intExtInt0, FALLING);    // Sw1    INT0# = enabled
detachInterrupt(1);                         // sensor INT1# = disabled
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// timer2 interrupt (interval=125ms, int=overflow)
// メインループのタイマー割り込み設定
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void setupTC2Int(){</p>
<p>MsTimer2::set(LOOP_INTERVAL, intTimer2);
}
//=====================================================================
// I2C　制御関数
// 
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//I2C スレーブデバイスに1バイト書き込む
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void i2c_write_byte(int device_address, int reg_address, int write_data){
Wire.beginTransmission(device_address);
Wire.write(reg_address);
Wire.write(write_data);
Wire.endTransmission();
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//I2C スレーブデバイスから1バイト読み込む
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
unsigned char i2c_read_byte(int device_address, int reg_address){</p>
<p>int read_data = 0;</p>
<p>Wire.beginTransmission(device_address);
Wire.write(reg_address);
Wire.endTransmission(false);</p>
<p>Wire.requestFrom(device_address, 1);
read_data = Wire.read();</p>
<p>return read_data;
}</p>
<p>//=====================================================================
// 各デバイスの初期設定
// 
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sensor
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void setupSensor(){</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// LIS2DH (accelerometer)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// I2C address
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
accel.begin(LIS2DH_ADDRESS);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// register
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
accel.writeRegister8(LIS3DH_REG_CTRL1, 0x07);    //X,Y,Z axis = enable
accel.setDataRate(LIS3DH_DATARATE_1_HZ);         //Data rate = 1Hz</p>
<p>accel.writeRegister8(LIS3DH_REG_CTRL2, 0x00);
accel.writeRegister8(LIS3DH_REG_CTRL3, 0x00);    // INT Disable
accel.writeRegister8(LIS3DH_REG_CTRL4, 0x80);    //BUD = enable, Scale = +/-2g</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// HTS221 (temperature /humidity)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
smeHumidity.begin();</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// OPT3001 (light)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
OPT3001_Config newConfig;
OPT3001_ErrorCode errorConfig;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// I2C address
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
light.begin(OPT3001_ADDRESS);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// config register
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
newConfig.RangeNumber = B1100;               // automatic full scale
newConfig.ConvertionTime = B1;               // convertion time = 800ms
newConfig.ModeOfConversionOperation = B11;   // continous conversion
newConfig.Latch = B0;                        // hysteresis-style</p>
<p>errorConfig = light.writeConfig(newConfig);</p>
<p>if(errorConfig != NO_ERROR){
errorConfig = light.writeConfig(newConfig);   //retry
}
}</p>
<p>//=====================================================================
// 割り込み処理
// 
//=====================================================================
//=====================================================================
// interrupt
//=====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Timer2 INT
// タイマー割り込み関数
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
void intTimer2(){</p>
<p>bInterval = 1;
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// Watchdog Timer INT
// WDT割り込み関数
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
ISR(WDT_vect){</p>
<p>wdt_disable();</p>
<p>countWDT += 1;</p>
<p>if (countWDT &gt;= wakeupWDT){
countWDT = 0;</p>
<p>}
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// INT0
// INT0割り込み関数
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
void intExtInt0(){
if (bEventSleep == false)
{
bEventSleep = true;
}
else
{
bEventSleep = false;
}
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// INT1
// INT1割り込み関数
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
void intExtInt1(){
//bWakeupINT1 = true;
}</p>
<p>//====================================================================
// functions
//====================================================================
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// counter /event
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// main loop
// メインループのループ回数をカウントし
// 1秒間隔でセンサーデータの取得をONにする
// 4秒間隔でスリープ確認をONにする
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void loopCounter(){</p>
<p>iLoop1s += 1;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// 1s period
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
if (iLoop1s &gt;=  8){             // 125ms x 8 = 1s</p>
<pre><code>iLoop1s = 0;
eventSensorRead = true;
eventWriteLCD = true;
</code></pre>
<p>}
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sensor
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// main loop
// センサーデータ取得がONのとき、各センサーからデータを取得
// コンソール出力がONのときシリアルに測定値と計算結果を出力する
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void loopSensor(){
double temp_mv;
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// 1s period
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
if (eventSensorRead == true){</p>
<pre><code>//-------------------------
// initialize parameter
//-------------------------
eventSensorRead = false;

//-------------------------
// LIS2DH
// 3軸センサーのデータ取得
//-------------------------
accel.read();
dataX_g = accel.x_g;    //X軸
dataY_g = accel.y_g;    //Y軸
dataZ_g = accel.z_g;    //Z軸

if(dataZ_g &gt;= 1.0){
  dataZ_g = 1.00;
} else if (dataZ_g &lt;= -1.0){
  dataZ_g = -1.00;
}

dataTilt = acos(dataZ_g)/PI*180;

//-------------------------
// HTS221
// 温湿度センサーデータ取得
//-------------------------
dataTemp = (float)smeHumidity.readTemperature();  //温度
dataHumid = (float)smeHumidity.readHumidity();    //湿度

//-------------------------
// 温度と湿度の2点補正
//-------------------------
dataTemp=TM0+(TM1-TM0)*(dataTemp-TL0)/(TL1-TL0);      // 温度補正
dataHumid=HM0+(HM1-HM0)*(dataHumid-HL0)/(HL1-HL0);    // 湿度補正

//-------------------------
// OPT3001
// 照度センサーデータ取得
//-------------------------
OPT3001 result = light.readResult();

if(result.error == NO_ERROR){
  dataLight = result.lux;
}
</code></pre>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// ADC081C027（ADC)
// 電池リーフ電池電圧取得
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
uint8_t adcVal1 = 0;
uint8_t adcVal2 = 0;</p>
<p>Wire.beginTransmission(BATT_ADC_ADDR);
Wire.write(0x00);
Wire.endTransmission(false);
Wire.requestFrom(BATT_ADC_ADDR,2);
adcVal1 = Wire.read();
adcVal2 = Wire.read();</p>
<p>if (adcVal1 == 0xff &amp;&amp; adcVal2 == 0xff) { 
//測定値がFFならバッテリリーフはつながっていない
adcVal1 = adcVal2 = 0;
}</p>
<p>//電圧計算　ADC　* （(リファレンス電圧(3.3V)/ ADCの分解能(256)) * 分圧比（２倍））
//dataBatt = (((adcVal1 &laquo; 4) | (adcVal2 &raquo; 4)) * (3.3 / 256)) * 2 ;
temp_mv = ((double)((adcVal1 &laquo; 4) | (adcVal2 &raquo; 4)) * 3300 * 2) / 256;
dataBatt = (float)(temp_mv / 1000);</p>
<pre><code>//-------------------------
// シリアルモニタ表示
//-------------------------
</code></pre>
<p>#ifdef DEBUG
Serial.println(&quot;&quot;);
#if 0 <br>
Serial.println(&quot;&mdash; sensor data &mdash;&quot;); <br>
Serial.println(&rdquo;  Tmp[degC]     = &quot; + String(dataTemp));
Serial.println(&rdquo;  Hum[%]        = &quot; + String(dataHumid));
Serial.println(&rdquo;  Lum[lx]       = &quot; + String(dataLight));
Serial.println(&rdquo;  Ang[arc deg]  = &quot; + String(dataTilt));
Serial.println(&rdquo;  Bat[V]        = &quot; + String(dataBatt));
//Serial.println(&quot;&quot;);
//Serial.println(&rdquo; Accel X,Y,Z&rdquo; + String(dataX_g) + &quot; &quot; + String(dataY_g) + &quot; &quot; + String(dataZ_g));
#else
Serial.println(&ldquo;T =&rdquo; + String(dataTemp) + &quot; H =&rdquo; + String(dataHumid) + &quot; L=&rdquo; + String(dataLight) + &quot; A=&rdquo; + String(dataTilt) + &quot; V=&rdquo; + String(dataBatt));
#endif <br>
#endif</p>
<pre><code>//bWakeupINT1 = false;
</code></pre>
<p>}</p>
<p>}
//debug ///
void getBattVal()
{
uint8_t adcVal1 = 0;
uint8_t adcVal2 = 0;</p>
<p>Wire.beginTransmission(BATT_ADC_ADDR);
Wire.write(0x00);
Wire.endTransmission(false);
Wire.requestFrom(BATT_ADC_ADDR,2);
adcVal1 = Wire.read();
adcVal2 = Wire.read();</p>
<p>if (adcVal1 == 0xff &amp;&amp; adcVal2 == 0xff) { 
//測定値がFFならバッテリリーフはつながっていない
adcVal1 = adcVal2 = 0;
}</p>
<p>//電圧計算　ADC　* （(リファレンス電圧(3.3V)/ ADCの分解能(256)) * 分圧比（２倍））
//dataBatt = (((adcVal1 &laquo; 4) | (adcVal2 &raquo; 4)) * (3.3 / 256)) * 2 ;
double temp_mv = ((double)((adcVal1 &laquo; 4) | (adcVal2 &raquo; 4)) * 3300 * 2) / 256;
float batval = (float)(temp_mv / 1000);
Serial.println(&rdquo; V=&rdquo; + String(batval));<br>
}
void loopLCD( void ){
/*  */
if( eventWriteLCD == true ){
eventWriteLCD = false;
veiwSencerData();
}
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
//  Veiw sensor data
// センサーデータを文字列に変換してLCDに表示する
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
void veiwSencerData(){</p>
<p>float value;
char temp[7], humid[7], light[7], tilt[7],battVolt[7];
char code[4];
char sendData[40];</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//センサーデータを文字列に変換
//dtostrf(変換する数字,変換される文字数,小数点以下の桁数,変換した文字の格納先);
//変換される文字数を-にすると変換される文字は左詰め、+なら右詰めとなる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Temperature (4Byte)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
value = dataTemp;</p>
<p>if(value &gt;= 100){
value = 99.9;
}
else if(value &lt;= -10){ <br>
value = -9.9;
} 
dtostrf(value,4,1,temp);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Humidity (4Byte)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
value = dataHumid;<br>
dtostrf(value,4,1,humid);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Ambient Light (5Byte)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
value = dataLight;</p>
<p>if(value &gt;= 100000){
value = 99999;
}   <br>
dtostrf(value,5,0,light);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Tilt (4Byte)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
value = dataTilt;</p>
<p>if(value &lt; 3){
value = 0;
}
dtostrf(value,4,0,tilt);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
// Battery Voltage (4Byte)
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
value = dataBatt;</p>
<p>if (value &gt;= 10){
value = 9.99;
}
dtostrf(value, 4, 2, battVolt);</p>
<p>trim(temp);
trim(humid);
trim(light); 
trim(tilt);
trim(battVolt);</p>
<p>lcd.clear();
switch (lcd_view_sts)
{
case 0:
//                 Tmp XX.X [degC]    <br>
lcd.print(&ldquo;Temp&rdquo;);
lcd.setCursor(0, 1);
lcd.print( String(temp) +&rdquo; C&rdquo;);     <br>
break;
case 1:
//                 Hum xx.x [%]
lcd.print(&ldquo;Humidity&rdquo;);
lcd.setCursor(0, 1);
lcd.print( String(humid) +&rdquo; %&quot;);  <br>
break;
case 2:
//                 Lum XXXXX [lx]
lcd.print(&ldquo;Luminous&rdquo;);
lcd.setCursor(0, 1);
lcd.print( String(light) +&rdquo; lx&rdquo;); 
break;
case 3:
//                 Ang XXXX [arc deg]
lcd.print(&ldquo;Angle&rdquo;);
lcd.setCursor(0, 1);
lcd.print( String(tilt) +&rdquo; deg&rdquo;);
break;
case 4:
//                 Bat X.XX [V]
lcd.print(&ldquo;Battery&rdquo;);
lcd.setCursor(0, 1);
lcd.print( String(battVolt) +&rdquo; V&rdquo;);
break;
default:
break;
}
if (lcd_view_sts &lt; 4){
lcd_view_sts++;
}
else{
lcd_view_sts = 0;
}</p>
<p>//debug//
#ifdef DEBUG 
//getBattVal();
#endif
//debug//
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
// trim 
// 文字列配列からSPを削除する
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
void trim(char * data)
{
int i = 0, j = 0;</p>
<p>while (<em>(data + i) != &lsquo;\0&rsquo;){
if (</em>(data + i) != ' &lsquo;){
*(data + j) = *(data + i);
j++;
}
i++;
}
*(data + j) = &lsquo;\0&rsquo;;
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// main loop
// スリープ移行要求があった場合、センサーリーフをSLEEPさせて
// WDTをセットしマイコンリーフをスリープさせる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void loopSleep(){</p>
<p>if (bEventSleep == true){
//bEventSleep = false;</p>
<p>#ifdef DEBUG
Serial.print(&rdquo;  &raquo;&gt; Go to sleep :  &ldquo;);
Serial.flush();
#endif
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
sleepLCD();
sleepSensor();
//wdt_start();
sleep();
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
//  wakeup
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
wakeupSensor();
wakeupLCD();</p>
<p>#ifdef DEBUG
Serial.println(&rdquo;  &laquo;&lt; Wake up &laquo;&lt;&rdquo;);
#endif     <br>
}
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// SLEEP
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void sleep(){<br>
ADCSRA &amp;= ~(1 &laquo; ADEN);                 //ADC停止
set_sleep_mode(SLEEP_MODE_PWR_DOWN);    //SET SLEEP MODE
sleep_enable();                         // SLEEP ENABLE</p>
<p>// BOD停止
MCUCR |= (1 &laquo; BODSE) | (1 &laquo; BODS);             // MCUCRのBODSとBODSEに1をセット
MCUCR = (MCUCR &amp; ~(1 &laquo; BODSE)) | (1 &laquo; BODS);  // すぐに（4クロック以内）BODSSEを0, BODSを1に設定
asm(&ldquo;sleep&rdquo;);                                   // 3クロック以内にスリープ 
sleep_disable();                         // SLEEP DISABLE
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// WDT
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void wdt_start(){
// watchdog timer reset
wdt_reset();</p>
<p>//disable interruput
cli();
//clear WatchDog system Reset Flag(WDRF)
MCUSR &amp;= ~(1 &laquo; WDRF);
// WDT変更許可
// WDCEとWDE同時セットで変更許可
WDTCSR |= 1 &laquo; WDCE | 1 &laquo; WDE;
//WDT設定
// WDE=0,WDIE=1 :WDT overflowで割り込み
// WDP3=1,WDP2=0,WDP1=0,WDP0=1: 8s
WDTCSR = 1 &laquo; WDIE | 0 &laquo; WDE | 1 &laquo; WDP3 | 0 &laquo; WDP2 | 0 &laquo; WDP1 | 1 &laquo; WDP0;
//enable interruput
sei();
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep sensor
// センサーリーフをスリープさせる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void sleepSensor(){</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// OPT3001 sleep
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
OPT3001_Config newConfig;
OPT3001_ErrorCode errorConfig;</p>
<p>newConfig.ModeOfConversionOperation = B00;
errorConfig = light.writeConfig(newConfig);
if(errorConfig != NO_ERROR){</p>
<pre><code>errorConfig = light.writeConfig(newConfig);
</code></pre>
<p>}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// LIS2DH sleep
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
accel.setDataRate(LIS3DH_DATARATE_POWERDOWN);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// HTS221 sleep
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
smeHumidity.deactivate();
}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// wakeup sensor
// センサーリーフをスリープから復帰させる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void wakeupSensor(){
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// OPT3001 wakeup
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
OPT3001_Config newConfig;
OPT3001_ErrorCode errorConfig;</p>
<p>newConfig.RangeNumber = B1100;               //automatic full scale
newConfig.ConvertionTime = B1;               //convertion time = 800ms
newConfig.ModeOfConversionOperation = B11;   //continous conversion
newConfig.Latch = B1;                        //latch window style</p>
<p>errorConfig = light.writeConfig(newConfig);
if(errorConfig != NO_ERROR){</p>
<pre><code>errorConfig = light.writeConfig(newConfig);   //retry
</code></pre>
<p>}</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// LIS2DH wakeup
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
accel.setDataRate(LIS3DH_DATARATE_1_HZ);</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// HTS221 wakeup
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
smeHumidity.activate(); 
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep LCD
// LCDリーフをスリープさせる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void sleepLCD()
{
lcd.noDisplay();
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep LCD
// LCDリーフをスリープさせる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void wakeupLCD(){
lcd.display();
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// poweroff LCD
// LCDの電源OFF
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void powerOffLCD(){</p>
<p>// LCD 電源 OFF
i2c_write_byte(I2C_EXPANDER_ADDR_LCD, 0x01, 0x00); 
}
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// wakeup LCD
// LCDリーフをスリープさせる
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
void powerOnLCD(){
// LCD 電源　ＯＮ
i2c_write_byte(I2C_EXPANDER_ADDR_LCD, 0x01, 0x01);
// LCDの電源が一度落ちたので、ＬＣＤを再設定
lcd.begin(8, 2);
lcd.setContrast(30);
lcd.clear();<br>
}</p>
<p>//====================================================================
// setup
//====================================================================
void setup() {</p>
<p>//WDT disable
wdt_disable();</p>
<p>delay(10);</p>
<p>Serial.begin(115200);       // UART 9600bps
Wire.begin();             // I2C 100KHz</p>
<p>i2c_write_byte(I2C_EXPANDER_ADDR_LCD, 0x03, 0xFE);
powerOnLCD();</p>
<p>#ifdef DEBUG
Serial.println(&ldquo;=========================================&rdquo;);
Serial.println(&ldquo;setup start&rdquo;);
#endif</p>
<p>setupPort();
delay(10);</p>
<p>noInterrupts();
setupExtInt();
setupTC2Int();
interrupts();</p>
<p>setupSensor();
MsTimer2::start();      // Timer2 inverval start</p>
<p>#ifdef DEBUG
Serial.println(&quot;&quot;);
Serial.println(&ldquo;=========================================&rdquo;);
Serial.println(&ldquo;loop start&rdquo;);
Serial.println(&quot;&quot;);
#endif</p>
<p>}</p>
<p>//====================================================================
// loop
//====================================================================
void loop() {</p>
<p>//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// Timer2 interval　125ms で1回ループ
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
if (bInterval == true){
bInterval = false; 
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; <br>
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// loop counter
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
loopCounter();
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sensor read
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
loopSensor();
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// LCD
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
loopLCD();
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
// sleep/resume
//&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;
loopSleep();
} 
}</p>

        <div class="section-index">
    
    
    
    
    <hr class="panel-line">
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
</div>

	
	
	<div class="text-muted mt-5 pt-3 border-top">最終更新 April 27, 2020: <a  href="/commit/6de42161d59b33ccb58349df1f590255e9a8bae4">4/27変更H (6de4216)</a>
</div>
</div>

          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/Leafony">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Developer mailing list" aria-label="Developer mailing list">
    <a class="text-white" target="_blank" href="https://example.org/mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2020 Trillion-Node Study Group All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/js/main.min.29b0315468c00226fa6f4556a9cebc0ac4fe1ce1457a01b22c0a06b329877383.js" integrity="sha256-KbAxVGjAAib6b0VWqc68CsT&#43;HOFFegGyLAoGsymHc4M=" crossorigin="anonymous"></script>



  </body>
</html>